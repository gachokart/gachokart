<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game3 Draft Helper з OpenDota</title>
<style>
body{background:#0b1220;color:#e6eef6;font-family:sans-serif;padding:20px;}
.card{background:#09111a;padding:12px;border-radius:8px;margin-bottom:12px;}
button{padding:6px 12px;margin:4px;cursor:pointer;border-radius:6px;}
.select-group{margin-bottom:12px;}
.column{display:inline-block;vertical-align:top;width:32%;margin-right:1%;}
.column:last-child{margin-right:0;}
.column h4{text-align:center;margin-bottom:6px;}
.hero-item{background:rgba(255,255,255,0.05);margin:2px;padding:4px;border-radius:4px;text-align:center;}
.result{margin-top:12px;padding:8px;border-radius:6px;background:rgba(255,255,255,0.05);}
</style>
</head>
<body>

<div class="card">
<h2>Game3 — Draft Helper з OpenDota</h2>
<div id="stageInfo">Стадія 1: оберіть 2 своїх героїв та 2 героїв ворога</div>

<div class="select-group" id="mySelectors"></div>
<div class="select-group" id="enemySelectors"></div>

<button id="nextStageBtn">GO</button>
</div>

<div class="card" id="recommendations" style="display:none;">
<h3>Рекомендації героїв</h3>
<div class="column" id="carryCol"><h4>Carry</h4></div>
<div class="column" id="supportCol"><h4>Support</h4></div>
<div class="column" id="universalCol"><h4>Universal</h4></div>
</div>

<div class="card result" id="finalResult" style="display:none;"></div>

<script>
let stage=1;
let myTeam=[], enemyTeam=[];
const stageLimits=[2,2,1];

const mySelectorsDiv=document.getElementById('mySelectors');
const enemySelectorsDiv=document.getElementById('enemySelectors');
const stageInfo=document.getElementById('stageInfo');
const nextStageBtn=document.getElementById('nextStageBtn');
const finalResult=document.getElementById('finalResult');
const carryCol=document.getElementById('carryCol');
const supportCol=document.getElementById('supportCol');
const universalCol=document.getElementById('universalCol');
const recommendations=document.getElementById('recommendations');

let heroesList=[];

// Завантажуємо героїв з OpenDota
async function fetchHeroes(){
    const res=await fetch('https://api.opendota.com/api/constants/heroes');
    const data=await res.json();
    heroesList=Object.values(data).map(h=>({id:h.id, name:h.localized_name, roles:h.roles, avg_score:Math.random()*10+5}));
    createSelectors(stageLimits[stage-1]);
    updateRecommendations();
}

fetchHeroes();

function createSelectors(count){
    mySelectorsDiv.innerHTML='';
    enemySelectorsDiv.innerHTML='';
    for(let i=0;i<count;i++){
        const mySel=document.createElement('select');
        const enemySel=document.createElement('select');
        heroesList.forEach(h=>{
            const opt1=document.createElement('option'); opt1.value=h.id; opt1.textContent=h.name; mySel.appendChild(opt1);
            const opt2=document.createElement('option'); opt2.value=h.id; opt2.textContent=h.name; enemySel.appendChild(opt2);
        });
        mySelectorsDiv.appendChild(mySel);
        enemySelectorsDiv.appendChild(enemySel);
    }
}

// Підрахунок середнього балу команди
function avgScore(team){
    if(team.length===0) return 0;
    return team.reduce((sum,id)=>sum+heroesList.find(h=>h.id==id).avg_score,0)/team.length;
}

// Оновлення рекомендацій
function updateRecommendations(){
    recommendations.style.display='block';
    carryCol.innerHTML=''; supportCol.innerHTML=''; universalCol.innerHTML='';
    const selectedIds=[...myTeam,...enemyTeam];
    const remaining=heroesList.filter(h=>!selectedIds.includes(h.id));
    remaining.forEach(h=>{
        const div=document.createElement('div');
        div.className='hero-item';
        div.textContent=h.name+' ('+h.avg_score.toFixed(1)+')';
        if(h.roles.includes('Carry')) carryCol.appendChild(div);
        else if(h.roles.includes('Support')) supportCol.appendChild(div);
        else universalCol.appendChild(div);
    });
}

// Після натискання GO
nextStageBtn.onclick=()=>{
    // Збираємо вибір
    const mySel=document.querySelectorAll('#mySelectors select');
    const enemySel=document.querySelectorAll('#enemySelectors select');
    myTeam.push(...Array.from(mySel).map(s=>parseInt(s.value)));
    enemyTeam.push(...Array.from(enemySel).map(s=>parseInt(s.value)));

    if(stage<3){
        stage++;
        stageInfo.textContent=`Стадія ${stage}: оберіть ${stageLimits[stage-1]} героїв своєї команди та ворога`;
        createSelectors(stageLimits[stage-1]);
        updateRecommendations();
    } else {
        // Після стадії 3
        recommendations.style.display='none';
        mySelectorsDiv.innerHTML=''; enemySelectorsDiv.innerHTML=''; nextStageBtn.style.display='none';
        finalResult.style.display='block';

        // Середній бал усіх героїв
        const allAvg=heroesList.reduce((sum,h)=>sum+h.avg_score,0)/heroesList.length;
        const myAvg=avgScore(myTeam)/2; // поділ на 2
        const winChance=Math.min(100, Math.max(0,50+(myAvg-allAvg)*5));

        // Вивід
        finalResult.innerHTML=`Моя команда: ${myTeam.map(id=>heroesList.find(h=>h.id==id).name).join(', ')}<br>
Ворожа команда: ${enemyTeam.map(id=>heroesList.find(h=>h.id==id).name).join(', ')}<br>
Середній бал усіх героїв: ${allAvg.toFixed(1)}<br>
Середній бал моїх героїв /2: ${myAvg.toFixed(1)}<br>
Прогнозований шанс на перемогу: ${winChance.toFixed(1)}%`;
    }
}
</script>
</body>
</html>


