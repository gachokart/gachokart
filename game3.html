<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>game3 — Виставлення ваг у колонках</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#9aa4b2;}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, Roboto, 'Helvetica Neue', Arial}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#071024);color:#e6eef6;min-height:100vh;padding:28px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:18px}
    .card{background:rgba(255,255,255,0.03);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    .small{font-size:13px;color:var(--muted)}
    label{display:block;font-size:13px;margin-bottom:6px}

    .top-row{display:flex;gap:12px}
    .left, .right{flex:1}

    .cols-area{margin-top:18px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px}
    .cols{display:flex;gap:12px;align-items:end;height:320px;padding:12px}
    .col {
  flex: 1;
  display: flex;
  flex-direction: row;
  align-items: flex-end;
  justify-content: center;
  gap: 8px;
}
    .value-pill {
  transform: translateX(10px); /* зсув праворуч, можна міняти на -10px для ліворуч */
}
    .bar{width:100%;height:100%;display:flex;align-items:flex-end;justify-content:center}

    /* vertical slider styling: rotate the range input */
    .vrange{appearance:none;width:240px;height:18px;transform:rotate(-90deg);-webkit-transform:rotate(-90deg);}
    .vrange::-webkit-slider-runnable-track{height:6px;background:#22303b;border-radius:6px}
    .vrange::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent);margin-top:-6px}
    .vrange::-moz-range-track{height:6px;background:#22303b;border-radius:6px}
    .vrange::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--accent)}

    .bar-fill{width:70%;background:linear-gradient(180deg,var(--accent),#036b8a);border-radius:6px 6px 2px 2px;display:flex;align-items:flex-end;justify-content:center}
    .value-pill{background:rgba(255,255,255,0.04);padding:6px 8px;border-radius:999px;font-weight:600;font-size:13px}

    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--accent);color:#04202a;border:0;padding:10px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    .footer{margin-top:16px;color:var(--muted);font-size:13px}

    @media (max-width:760px){
      .cols{height:240px}
      .vrange{width:180px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>game3 — Виставлення ваг (0 → 1) в колонках</h1>
      <div class="small">Виберіть кількість значень, тягніть повзунки в колонках, і поставте власні межі (наприклад 0.04–0.96).</div>
    </header>

    <div class="top-row">
      <div class="card left">
        <div class="controls" style="align-items:center;">
          <div>
            <label for="count">Кількість значень</label>
            <input id="count" type="number" min="1" max="40" value="6" style="width:90px;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:inherit;font-weight:700">
          </div>

          <div>
            <label for="minBound">Мінімум межі (0–1)</label>
            <input id="minBound" type="number" step="0.01" min="0" max="1" value="0.04" style="width:110px;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);">
          </div>

          <div>
            <label for="maxBound">Максимум межі (0–1)</label>
            <input id="maxBound" type="number" step="0.01" min="0" max="1" value="0.96" style="width:110px;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);">
          </div>

          <div style="display:flex;flex-direction:column;justify-content:flex-end;">
            <label class="small">Дія</label>
            <div class="actions">
              <button id="randomize">Випадково</button>
              <button id="normalize">Нормалізувати (сума=1)</button>
              <button id="rescale">Масштабувати в межі</button>
              <button id="clamp" class="ghost">Прив'язати до меж</button>
            </div>
          </div>
        </div>

        <div style="margin-top:10px;color:var(--muted);font-size:13px">Порада: натисніть "Масштабувати в межі", щоб пропорційно розподілити поточні значення в обраний інтервал. "Прив'язати до меж" просто обрізає значення до меж.</div>
      </div>

      <div class="card right" style="width:320px">
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
          <div>
            <label class="small">Поточні значення (після нормалізації)</label>
            <div id="sumText" style="font-weight:700;font-size:16px">Сума: 1.00</div>
          </div>
          <div style="text-align:right">
            <label class="small">Крок повзунка</label>
            <div style="font-weight:700">0.01</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-direction:column">
          <div class="small">Режим підрахунку:</div>
          <select id="mode" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:0;color:inherit;font-weight:700">
            <option value="direct">Прямі значення (0–1)</option>
            <option value="relative">Відносні (після нормалізації сума=1)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card cols-area">
      <div class="cols" id="cols"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px">
        <div class="small">Показано числове значення під колонкою. Тягніть круглі повзунки або змініть вручну.</div>
        <div>
          <button id="export">Експорт JSON</button>
        </div>
      </div>
    </div>

    <div class="footer">Збережіть або експортуйте значення, скопіювавши JSON. Максимальна кількість колонок — 40.</div>
  </div>

<script>
  // Ключові елементи
  const countInput = document.getElementById('count');
  const colsWrap = document.getElementById('cols');
  const sumText = document.getElementById('sumText');
  const minBoundInput = document.getElementById('minBound');
  const maxBoundInput = document.getElementById('maxBound');
  const randomizeBtn = document.getElementById('randomize');
  const normalizeBtn = document.getElementById('normalize');
  const rescaleBtn = document.getElementById('rescale');
  const clampBtn = document.getElementById('clamp');
  const exportBtn = document.getElementById('export');
  const modeSelect = document.getElementById('mode');

  let values = []; // числові значення 0..1

  function createCols(n){
    colsWrap.innerHTML = '';
    values = new Array(n).fill(0).map(()=>+(Math.random()).toFixed(2));
    // ensure not all zero
    if(values.every(v=>v===0)) values[0]=0.5;
    values = values.map(v=>clamp(v,0,1));

    for(let i=0;i<n;i++){
      const col = document.createElement('div');
      col.className='col';

      const label = document.createElement('div');
      label.className='value-pill';
      label.textContent = values[i].toFixed(2);

      const barWrap = document.createElement('div');
      barWrap.className='bar';

      const barFill = document.createElement('div');
      barFill.className='bar-fill';
      barFill.style.height = (values[i]*100)+'%';
      barFill.style.width = '72%';

      barWrap.appendChild(barFill);

      // vertical range input (rotated)
      const input = document.createElement('input');
      input.type = 'range';
      input.min = 0; input.max = 1; input.step = 0.01; input.value = values[i];
      input.className = 'vrange';
      input.dataset.index = i;

      input.addEventListener('input', (e)=>{
        const idx = +e.target.dataset.index;
        const v = +(+e.target.value).toFixed(2);
        values[idx] = v;
        label.textContent = v.toFixed(2);
        barFill.style.height = (v*100)+'%';
        updateSum();
      });

      // double-click to zero or reset
      input.addEventListener('dblclick', ()=>{
        const idx = +input.dataset.index;
        values[idx] = 0;
        input.value = 0;
        label.textContent = '0.00';
        barFill.style.height = '0%';
        updateSum();
      });

      
      col.appendChild(barWrap);
      col.appendChild(input);
      col.appendChild(label);
      colsWrap.appendChild(col);
    }
    updateSum();
  }

  function clamp(x,a,b){ return Math.min(b,Math.max(a,x)); }

  function updateSum(){
    const sum = values.reduce((s,x)=>s+x,0);
    sumText.textContent = 'Сума: '+sum.toFixed(2);
  }

  // Normalize so that sum(values) == 1 (if sum == 0, distribute evenly)
  function normalize(){
    const sum = values.reduce((s,x)=>s+x,0);
    if(sum===0){
      const n = values.length;
      values = values.map(()=>+(1/n).toFixed(2));
    } else {
      values = values.map(v=>+(v/sum).toFixed(2));
      // fix rounding so total exactly 1.00 by adjusting largest element
      let newSum = values.reduce((s,x)=>s+x,0);
      const diff = +(1 - newSum).toFixed(2);
      if(Math.abs(diff) > 0){
        const idx = values.reduce((i,cur,ind,arr)=> cur>arr[i]?ind:i,0);
        values[idx] = +(values[idx] + diff).toFixed(2);
        if(values[idx] < 0) values[idx] = 0;
      }
    }
    // push values to DOM
    syncDomFromValues();
    updateSum();
  }

  // Rescale values proportionally into [minBound, maxBound]
  function rescaleToBounds(){
    let minB = parseFloat(minBoundInput.value);
    let maxB = parseFloat(maxBoundInput.value);
    if(isNaN(minB)) minB=0; if(isNaN(maxB)) maxB=1;
    if(minB<0) minB=0; if(maxB>1) maxB=1;
    if(minB >= maxB){ alert('Мінімум має бути менше максимуму'); return; }

    // Normalize first so we have proportions
    const total = values.reduce((s,x)=>s+x,0);
    let rel = values.slice();
    if(total === 0) rel = rel.map(()=>1/rel.length);
    else rel = rel.map(v=>v/total);

    // Map proportionally: new = minB + rel*(maxB-minB)
    values = rel.map(r=>+(minB + r*(maxB-minB)).toFixed(2));

    // Fix rounding to keep each within bounds and sum maybe not 1
    syncDomFromValues();
    updateSum();
  }

  // Clamp each value to [minBound, maxBound]
  function clampToBounds(){
    let minB = parseFloat(minBoundInput.value);
    let maxB = parseFloat(maxBoundInput.value);
    if(isNaN(minB)) minB=0; if(isNaN(maxB)) maxB=1;
    if(minB >= maxB){ alert('Мінімум має бути менше максимуму'); return; }
    values = values.map(v=>+(clamp(v,minB,maxB)).toFixed(2));
    syncDomFromValues();
    updateSum();
  }

  function syncDomFromValues(){
    const inputs = colsWrap.querySelectorAll('input[type=range]');
    inputs.forEach(inp=>{
      const i = +inp.dataset.index;
      inp.value = values[i];
      const col = inp.closest('.col');
      col.querySelector('.value-pill').textContent = values[i].toFixed(2);
      col.querySelector('.bar-fill').style.height = (values[i]*100)+'%';
    });
  }

  // Event listeners
  countInput.addEventListener('change', ()=>{ let n = +countInput.value || 1; n = Math.max(1,Math.min(40,n)); countInput.value = n; createCols(n); });
  randomizeBtn.addEventListener('click', ()=>{ values = values.map(()=>+(Math.random()).toFixed(2)); syncDomFromValues(); updateSum(); });
  normalizeBtn.addEventListener('click', ()=>{ normalize(); });
  rescaleBtn.addEventListener('click', ()=>{ rescaleToBounds(); });
  clampBtn.addEventListener('click', ()=>{ clampToBounds(); });

  exportBtn.addEventListener('click', ()=>{
    const payload = { values: values, bounds: { min: parseFloat(minBoundInput.value), max: parseFloat(maxBoundInput.value) }, mode: modeSelect.value };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'weights.json'; a.click();
    URL.revokeObjectURL(url);
  });

  // initialize
  createCols(+countInput.value);
</script>
</body>
</html>

