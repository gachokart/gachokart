<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Role-based Prediction Demo</title>
<style>
  body { background:#0b1220; color:#fff; font-family:sans-serif; padding:20px; }
  .card { background:#111a2a; padding:20px; border-radius:12px; max-width:360px; margin:auto; }
  select { padding:8px; border-radius:8px; background:transparent; color:white; border:1px solid rgba(255,255,255,0.2); }
  .prob { font-size:48px; font-weight:600; margin-top:10px; }
</style>
</head>
<body>

<div class="card" id="rolePredictionCard">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div>
      <div style="font-size:13px; color:#9ca3af;">Оберіть роль:</div>
      <select id="roleSelect">
        <option value="1">1 — Carry</option>
        <option value="2">2 — Mid</option>
        <option value="3" selected>3 — Offlane</option>
        <option value="4">4 — Soft support</option>
        <option value="5">5 — Hard support</option>
      </select>
    </div>
    <div style="text-align:right;">
      <div id="winPercent" class="prob">—%</div>
      <div style="font-size:12px; color:#9ca3af;">Шанс перемоги</div>
    </div>
  </div>
</div>

<script>
// --- Фейкові дані, схожі на ті що з analyzeMatches()
const lastSummary = {
  winrate: 54,
  avgK: 7.1, avgD: 5.5, avgA: 10.3,
  avgDuration: 1800,
  pctShortLosses: 12,
  leaveRate: 1,
  byRole: {
    1: { winrate: 60 },
    2: { winrate: 48 },
    3: { winrate: 52 },
    4: { winrate: 56 },
    5: { winrate: 50 }
  }
};

// --- Ваги
const defaultWeights = {
  winrate: 0.9,
  kda: 6,
  shortGamePenalty: -3,
  shortLossPenalty: -4,
  leaveRatePenalty: v => -Math.min(10, Math.round(v))
};

// --- Головна функція
function computeDetailedProbabilities(summary, role = 3, weights = defaultWeights) {
  let winProb = baseWinProb(summary, weights);
  const roleHistory = summary.byRole ? (summary.byRole[role] || { winrate: 50 }) : { winrate: 50 };
  const roleEffect = 0.3 * (roleHistory.winrate - 50); // ±15% макс
  winProb += roleEffect;
  return { winProb: Math.max(3, Math.min(97, Math.round(winProb))) };
}

// --- Базовий розрахунок
function baseWinProb(summary, w) {
  let winProb = 50;
  const winrateDelta = Math.log10(Math.max(1, summary.winrate)) * w.winrate - w.winrate * Math.log10(50);
  const kdaRatio = summary.avgD > 0 ? (summary.avgK + summary.avgA) / summary.avgD : summary.avgK + summary.avgA;
  const kdaDelta = (kdaRatio - 2) * w.kda;
  winProb += winrateDelta + kdaDelta;
  return winProb;
}

// --- Оновлення UI
function updateRoleCard(summary, result) {
  document.getElementById("winPercent").textContent = result.winProb + "%";
}

// --- При старті (роля 3)
updateRoleCard(lastSummary, computeDetailedProbabilities(lastSummary, 3));

// --- Реакція на зміну
document.getElementById("roleSelect").addEventListener("change", () => {
  const role = Number(document.getElementById("roleSelect").value);
  const result = computeDetailedProbabilities(lastSummary, role, defaultWeights);
  updateRoleCard(lastSummary, result);
});
</script>

</body>
</html>


