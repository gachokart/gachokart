<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>game3 — Draft Helper з вибором героїв</title>
<style>
body{background:#0b1220;color:#e6eef6;font-family:sans-serif;padding:20px;}
.card{background:#09111a;padding:12px;border-radius:8px;margin-bottom:12px;}
button{padding:6px 12px;margin:4px;cursor:pointer;border-radius:6px;}
.hero-select{margin:6px 0;}
.column{display:inline-block;vertical-align:top;width:32%;margin-right:1%;}
.column:last-child{margin-right:0;}
.column h4{text-align:center;margin-bottom:6px;}
.hero-item{background:rgba(255,255,255,0.05);margin:2px;padding:4px;border-radius:4px;text-align:center;cursor:pointer;}
.hero-item.selected{background:#1f8feb;}
.result{margin-top:12px;padding:8px;border-radius:6px;background:rgba(255,255,255,0.05);}
.flex-row{display:flex;gap:10px;flex-wrap:wrap;}
</style>
</head>
<body>
<div class="card">
<h2>Game3 — Draft Helper</h2>
<div id="stageInfo">Стадія 1: оберіть 2 своїх героїв та 2 героїв ворога</div>
<div>Моя команда: <span id="myHeroesCount">0/2</span></div>
<div>Ворожа команда: <span id="enemyHeroesCount">0/2</span></div>
<button id="nextStageBtn">GO</button>
</div>

<div class="card" id="recommendations" style="display:none;">
<h3>Рекомендації героїв</h3>
<div class="column" id="carryCol"><h4>Carry</h4></div>
<div class="column" id="supportCol"><h4>Support</h4></div>
<div class="column" id="universalCol"><h4>Universal</h4></div>
</div>

<div class="card result" id="finalResult" style="display:none;"></div>
<div class="column" id="carryCol"><h4>Carry</h4></div>
<div class="column" id="supportCol"><h4>Support</h4></div>
<div class="column" id="universalCol"><h4>Universal</h4></div>
<script>
let stage=1;
let myTeam=[], enemyTeam=[];
let stageLimits=[2,2,1]; // Скільки героїв обираємо кожної стадії
let mySelectionCount=0, enemySelectionCount=0;

const carryCol=document.getElementById('carryCol');
const supportCol=document.getElementById('supportCol');
const universalCol=document.getElementById('universalCol');
const stageInfo=document.getElementById('stageInfo');
const finalResult=document.getElementById('finalResult');
const myHeroesCount=document.getElementById('myHeroesCount');
const enemyHeroesCount=document.getElementById('enemyHeroesCount');
const nextStageBtn=document.getElementById('nextStageBtn');

let heroesList=[];

// Завантаження героїв з OpenDota
async function fetchHeroes(){
    const res=await fetch('https://api.opendota.com/api/constants/heroes');
    const data=await res.json();
    heroesList=Object.values(data).map(h=>({
        id:h.id,
        name:h.localized_name,
        roles:h.roles,
        img:'https://cdn.cloudflare.steamstatic.com'+h.img,
        avg_score:Math.random()*10+5
    }));
    updateRecommendations(); // після завантаження оновлюємо колонки
}

// Створення клікабельних карток героїв
function updateRecommendations(){
    ['carryCol','supportCol','universalCol'].forEach(id=>document.getElementById(id).innerHTML='');
    const remaining=heroesList.filter(h=>!myTeam.includes(h.id) && !enemyTeam.includes(h.id));
    remaining.forEach(h=>{
        const div=document.createElement('div');
        div.className='hero-item';
        div.innerHTML=`<img src="${h.img}" width="48" height="27"><br>${h.name}<br>(${h.avg_score.toFixed(1)})`;
        div.onclick=()=>selectHero(h.id);
        if(h.roles.includes('Carry')) document.getElementById('carryCol').appendChild(div);
        else if(h.roles.includes('Support')) document.getElementById('supportCol').appendChild(div);
        else document.getElementById('universalCol').appendChild(div);
    });
}
fetchHeroes().then(()=>{updateRecommendations();});

// Функція оновлення рекомендацій
function updateRecommendations(){
    carryCol.innerHTML=''; supportCol.innerHTML=''; universalCol.innerHTML='';
    const remaining=heroesList.filter(h=>!myTeam.includes(h.id)&&!enemyTeam.includes(h.id));
    remaining.forEach(h=>{
        const div=document.createElement('div');
        div.className='hero-item';
        div.textContent=h.name+' ('+h.avg_score.toFixed(1)+')';
        div.onclick=()=>selectHero(h.id);
        if(h.roles.includes('Carry')) carryCol.appendChild(div);
        else if(h.roles.includes('Support')) supportCol.appendChild(div);
        else universalCol.appendChild(div);
    });
}

// Вибір героя
function selectHero(id){
    // Визначаємо чи обираємо свою команду чи ворога
    if(mySelectionCount<stageLimits[stage-1]){
        if(!myTeam.includes(id)){
            myTeam.push(id);
            mySelectionCount++;
        }
    } else if(enemySelectionCount<stageLimits[stage-1]){
        if(!enemyTeam.includes(id)){
            enemyTeam.push(id);
            enemySelectionCount++;
        }
    }
    myHeroesCount.textContent=mySelectionCount+'/'+stageLimits[stage-1];
    enemyHeroesCount.textContent=enemySelectionCount+'/'+stageLimits[stage-1];
    updateRecommendations();
}

// Обчислення середнього балу
function avgScore(team){
    if(team.length===0) return 0;
    let sum=0;
    team.forEach(id=>{
        const h=heroesList.find(x=>x.id===id);
        if(h) sum+=h.avg_score;
    });
    return sum/team.length;
}

// Перехід на наступну стадію
nextStageBtn.onclick=()=>{
    if(mySelectionCount<stageLimits[stage-1] || enemySelectionCount<stageLimits[stage-1]){
        alert("Обирайте всіх героїв цієї стадії!");
        return;
    }
    if(stage<3){
        stage++;
        mySelectionCount=0;
        enemySelectionCount=0;
        myHeroesCount.textContent='0/'+stageLimits[stage-1];
        enemyHeroesCount.textContent='0/'+stageLimits[stage-1];
        stageInfo.textContent=`Стадія ${stage}: оберіть ${stageLimits[stage-1]} героїв своєї команди та ворога`;
        updateRecommendations();
    } else {
        // Після стадії 3
        recommendations.style.display='none';
        stageInfo.textContent='Всі стадії завершено';
        finalResult.style.display='block';
        const allAvg=heroesList.reduce((sum,h)=>sum+h.avg_score,0)/heroesList.length;
        const myAvg=avgScore(myTeam)/2;
        const winChance=Math.min(100, Math.max(0,50+(myAvg-allAvg)*5));
        finalResult.textContent=`Середній бал усіх героїв: ${allAvg.toFixed(1)}, середній бал моїх героїв /2: ${myAvg.toFixed(1)}. Прогнозований шанс на перемогу: ${winChance.toFixed(1)}%`;
    }
}
</script>
</body>
</html>

