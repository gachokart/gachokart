<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dota 2 Draft Helper</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fira+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  background:#07111b;
  color:#fff;
  font-family:'Fira Sans', sans-serif;
  margin:0;
  padding:0 20px;
}
h1,h3 {font-family:'Press Start 2P';}
#recommendations {display:flex; gap:10px; margin-top:20px;}
</style>
</head>
<body>
<h1 style="text-align:center;">Dota 2 Draft Helper</h1>

<div style="text-align:center; margin-bottom:10px;">
  <button id="myTeamMode">–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</button>
  <button id="enemyTeamMode">–í–æ—Ä–æ–≥–∏</button>
</div>

<div style="display:flex; gap:20px; justify-content:center;">
  <div style="flex:1">
    <h3>–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</h3>
    <ul id="myTeam"></ul>
  </div>
  <div style="flex:1">
    <h3>–í–æ—Ä–æ–≥–∏</h3>
    <ul id="enemyTeam"></ul>
  </div>
</div>

<div id="recommendations"></div>

<script>
const accountId = 863386335; // —Ç–≤—ñ–π OpenDota ID
let mode = "myTeam"; 
const myTeam = [];
const enemyTeam = [];

document.getElementById("myTeamMode").onclick = ()=> mode="myTeam";
document.getElementById("enemyTeamMode").onclick = ()=> mode="enemyTeam";

let carry=[], support=[], universal=[];

// ====================== –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• ======================
async function loadCombinedHeroData() {
  try {
    const [localHeroes, personalData, heroStats] = await Promise.all([
      fetch("heroes.json").then(r => r.json()),
      fetch(`https://api.opendota.com/api/players/${accountId}/heroes`).then(r => r.json()),
      fetch("https://api.opendota.com/api/heroStats").then(r => r.json())
    ]);

    const getHeroById = id => heroStats.find(h => h.id === id);

    const personalScores = personalData
      .filter(h => h.games > 5)
      .map(h => {
        const hero = getHeroById(h.hero_id);
        if (!hero) return null;
        const winrate = h.win / h.games;
        const score = (winrate * 0.7 + Math.min(h.games,100)/100*0.3)*100;
        return { id: hero.id, name: hero.localized_name, score, roles: hero.roles };
      })
      .filter(Boolean);

    const merged = localHeroes.map(lh=>{
      const match = personalScores.find(ph=>ph.name===lh.localized_name);
      const score = match ? (lh.score+match.score)/2 : lh.score;
      const roles = lh.roles || match?.roles || [];
      const id = match?.id || lh.id;
      return {...lh, score, roles, id};
    });

    carry = merged.filter(h=>h.roles.some(r=>["Carry","Pusher","Nuker"].includes(r))).sort((a,b)=>b.score-a.score).slice(0,15);
    support = merged.filter(h=>h.roles.some(r=>["Support","Disabler"].includes(r))).sort((a,b)=>b.score-a.score).slice(0,15);
    universal = merged.filter(h=>!h.roles.some(r=>["Carry","Support"].includes(r))).sort((a,b)=>b.score-a.score).slice(0,15);

    updateRecommendations();

  } catch(err) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö OpenDota:", err);
  }
}

// ====================== –í–ò–ë–Ü–† –ì–ï–†–û–á–í ======================
function pickHero(hero){
  const allSelected = [...myTeam,...enemyTeam];
  if(allSelected.some(h=>h.id===hero.id)) return;

  if(mode==="myTeam") myTeam.push(hero);
  else enemyTeam.push(hero);

  updateTeam("myTeam", myTeam);
  updateTeam("enemyTeam", enemyTeam);
  updateRecommendations();
}

function updateTeam(id, team){
  const ul = document.getElementById(id);
  ul.innerHTML="";
  team.forEach(h=>{
    const li=document.createElement("li");
    li.textContent = `${h.name} (${(h.score||0).toFixed(1)})`;
    ul.appendChild(li);
  });
}

// ====================== –í–Ü–ó–£–ê–õ–Ü–ó–ê–¶–Ü–Ø ======================
function renderHeroColumn(id, title, heroes){
  let div = document.getElementById(id);
  if(!div){
    div = document.createElement("div");
    div.id=id;
    div.style.flex="1";
    div.style.padding="10px";
    div.style.background="rgba(0,0,0,0.5)";
    div.style.borderRadius="12px";
    div.style.margin="10px";
    document.getElementById("recommendations").appendChild(div);
  }

  div.innerHTML=`<h3 style="color:#ffcc00;text-align:center;font-family:'Press Start 2P';font-size:12px;">${title}</h3>`;
  const ul = document.createElement("ul");
  ul.style.listStyle="none"; ul.style.padding="0";

  const allSelected = [...myTeam,...enemyTeam];

  heroes.forEach(h=>{
    const li = document.createElement("li");
    li.textContent = `${h.name} (${(h.score||0).toFixed(1)})`;
    li.style.fontSize="13px"; li.style.margin="4px 0";

    if(allSelected.some(sel=>sel.id===h.id)){
      li.style.color="#888";
      li.style.textDecoration="line-through";
    } else {
      li.style.cursor="pointer";
      li.onclick=()=>pickHero(h);
      li.style.color=h.score>65?"#7CFC00":h.score<45?"#ff4444":"#fff";
    }
    ul.appendChild(li);
  });
  div.appendChild(ul);
}

function updateRecommendations(){
  renderHeroColumn("carryColumn","üó° Carry",carry);
  renderHeroColumn("supportColumn","üíâ Support",support);
  renderHeroColumn("universalColumn","üåÄ Universal",universal);
}

// ====================== –°–¢–ê–†–¢ ======================
loadCombinedHeroData();
</script>
</body>
</html>

