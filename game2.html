<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dota 2 Draft Helper</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fira+Sans:wght@400;600&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    padding: 0;
    background: url('flags/LOGO11.png') no-repeat center center fixed;
    background-size: cover;
    font-family: 'Fira Sans', sans-serif;
    color: #fff;
    text-align: center;
  }

  h1 {
    font-family: 'Press Start 2P';
    font-size: 28px;
    color: #ff0000;
    text-shadow: 0 0 10px #ff0000, 0 0 20px #aa0000;
    margin: 20px 0;
  }

  h2 {
    font-family: 'Press Start 2P';
    font-size: 16px;
    margin: 10px 0;
    color: #fff;
    text-shadow: 0 0 5px #000;
  }

  .team-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .team {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .team select, .team input {
    margin: 5px 0;
    padding: 8px;
    border-radius: 8px;
    border: none;
    width: 180px;
    text-align: center;
    font-family: 'Fira Sans';
    font-size: 14px;
  }

 button {
  background: linear-gradient(to bottom, #ffcc00, #cc9900);
  color: #000;
  border: 2px solid #000;
  padding: 12px 30px;
  border-radius: 8px;
  font-weight: bold;
  font-family: 'Fira Sans';
  box-shadow: 0 0 10px #ffcc00;
  transition: all 0.2s ease;
}

button:hover {
  background: linear-gradient(to bottom, #ffaa00, #cc7700);
  transform: scale(1.05);
  box-shadow: 0 0 15px #ffaa00;
}

#resultsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 25px;
  justify-items: center;
  padding: 15px;
  margin-top: 20px;
}

.resultColumn {
  width: 100%;
  max-width: 280px;
  background: rgba(0,0,0,0.65);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 0 10px #ffcc00;
  text-align: center;
}

.resultColumn h3 {
  margin-bottom: 8px;
  font-family: 'Press Start 2P';
  font-size: 14px;
  text-shadow: 0 0 5px #000;
}

.hero {
  background: #222;
  margin: 6px 0;
  padding: 8px 10px;
  border-radius: 10px;
  box-shadow: 0 0 6px #000;
  font-size: 13px;
}

  #stageTitle {
  font-family: 'Press Start 2P';
  font-size: 18px;
  color: #ffcc00;
  text-shadow: 0 0 10px #000, 0 0 5px #ff0000;
  margin-bottom: 15px;
}

  #teamsDisplay {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  max-width: 1000px;
  margin: 20px auto;
  gap: 20px;
}

#teamsDisplay .column {
  flex: 1;                /* —É—Å—ñ –æ–¥–Ω–∞–∫–æ–≤—ñ */
  min-width: 200px;       /* —â–æ–± –Ω–µ –ª–∞–º–∞–ª–∏—Å—å –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
  background: rgba(0,0,0,0.7);
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 0 10px #ffcc00;
  text-align: center;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#teamsDisplay .column:hover {
  transform: scale(1.04);
  box-shadow: 0 0 15px #ffaa00;
}

#teamsDisplay h3 {
  font-family: 'Press Start 2P';
  font-size: 14px;
  margin-bottom: 10px;
  color: #ffcc00;
  text-shadow: 0 0 5px #000;
}

#teamsDisplay ul {
  list-style: none;
  padding: 0;
  margin: 0;
  font-size: 14px;
}
  #draftSummary {
    display: none;
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
    background: rgba(46,46,46,0.85);
    border-radius: 15px;
    text-align: center;
  }

  #summaryContainer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  #summaryMyTeam, #summaryEnemyTeam {
    list-style: none;
    padding: 0;
    width: 40%;
  }

  #summaryCenter {
    width: 20%;
  }

  #summaryBar {
    height: 20px;
    background: #ff0000;
    width: 0%;
    border-radius: 10px;
  }

  #controls {
    margin: 15px 0;
  }

  #controls input {
    margin-right: 5px;
  }

</style>
</head>

<body>
<h1>Dota 2 Draft Helper</h1>
  
<!-- üîπ –î–æ–¥–∞—î–º–æ –Ω–∞–ø–∏—Å —Å—Ç–∞–¥—ñ—ó -->
<h2 id="stageTitle">Stage 1</h2>  

<div id="selectorsContainer">


<div id="myTeam" class="team"></div>


<div id="enemyTeam" class="team"></div>

<button id="nextBtn">Go</button>

<div id="results"></div>

</div>
<div id="controls">
  <label>
    <input type="checkbox" id="behaviorMode">
    üé≠ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤–∏–π —Ñ–∞–∫—Ç–æ—Ä
  </label>
</div>

  <div id="teamsDisplay">
  <div class="column">
    <h3>üü¶ –ú–æ—è –∫–æ–º–∞–Ω–¥–∞</h3>
    <ul id="myTeamList"></ul>
  </div>



  <div class="column">
    <h3>üü• –°—É–ø–µ—Ä–Ω–∏–∫–∏</h3>
    <ul id="enemyTeamList"></ul>
  </div>
</div>
  <div id="draftSummary" style="display:none;">
  <div id="summaryContainer" 
       style="display:flex; justify-content:space-between; align-items:center; 
              background:url('LOGO9.png') center/cover no-repeat; 
              padding:20px; border-radius:15px; color:#fff; margin:20px auto; max-width:900px;">
    <ul id="summaryMyTeam" style="list-style:none; padding:0; text-align:center;"></ul>
    <div id="summaryCenter" style="text-align:center;">
      <h2 id="summaryChance" style="margin-bottom:10px;"></h2>
      <div style="background:rgba(0,0,0,0.5); border-radius:10px; overflow:hidden; width:150px; height:20px; margin:0 auto;">
        <div id="summaryBar" style="background:#ff0000; width:0%; height:100%;"></div>
      </div>
      <p id="summaryBehavior" style="margin-top:10px;"></p>
    </div>
    <ul id="summaryEnemyTeam" style="list-style:none; padding:0; text-align:center;"></ul>
  </div>
</div>
<div id="behaviorInfo" style="display:none; margin-top:15px; color:#ff6666;"></div>
<div id="myHeroes" style="margin-top:40px;text-align:center;">
  <h2 style="color:#fff;">–ú–æ—ó –Ω–∞–π–∫—Ä–∞—â—ñ –≥–µ—Ä–æ—ó</h2>
  <div id="heroTables" style="display:flex;justify-content:center;gap:30px;flex-wrap:wrap;">
    <div style="flex:1;min-width:200px;">
      <h3 style="color:#66c2ff;">Carry</h3>
      <ul id="carryHeroes" style="list-style:none;padding:0;color:#fff;"></ul>
    </div>
    <div style="flex:1;min-width:200px;">
      <h3 style="color:#7aff66;">Support</h3>
      <ul id="supportHeroes" style="list-style:none;padding:0;color:#fff;"></ul>
    </div>
    <div style="flex:1;min-width:200px;">
      <h3 style="color:#ffcc66;">Universal</h3>
      <ul id="universalHeroes" style="list-style:none;padding:0;color:#fff;"></ul>
    </div>
  </div>
</div>



<script>
// =========================
// üî• –í–®–ò–¢–ò–ô heroes.json
// =========================
  // ====================== OPEN DOTA INTEGRATION ======================
const accountId = 863386335; // —Ç–≤—ñ–π ID
let heroes = [];              // –º–∞—Å–∏–≤ —É—Å—ñ—Ö –≥–µ—Ä–æ—ó–≤
let personalHeroScores = [];  // –º–∞—Å–∏–≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

async function loadOpenDotaData() {
  try {
    // 1Ô∏è‚É£ –û—Ç—Ä–∏–º—É—î–º–æ –±–∞–∑–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≥–µ—Ä–æ—ó–≤
    const heroRes = await fetch("https://api.opendota.com/api/heroStats");
    const heroData = await heroRes.json();

    heroes = heroData.map(h => ({
      id: h.id,
      name: h.localized_name,
      roles: h.roles,
      winrate: h.pro_win / Math.max(h.pro_pick || 1, 1),
      pickrate: (h.pro_pick || 0) / 1000,
      img: "https://cdn.cloudflare.steamstatic.com" + h.img
    }));

    // 2Ô∏è‚É£ –û—Ç—Ä–∏–º—É—î–º–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const personalRes = await fetch(`https://api.opendota.com/api/players/${accountId}/heroes`);
    const personalData = await personalRes.json();

    personalHeroScores = personalData.map(p => {
      const hero = heroes.find(h => h.id === p.hero_id);
      return {
        id: p.hero_id,
        name: hero ? hero.name : `Hero #${p.hero_id}`,
        games: p.games,
        winrate: p.win / Math.max(p.games, 1),
        score: (p.win / Math.max(p.games, 1)) * Math.log10(p.games + 1) * 100
      };
    });
const roleCategories = {
  carry: { roles: ["Carry", "Pusher", "Nuker"], weight: 3 },
  support: { roles: ["Support", "Disabler"], weight: 2 },
  universal: { roles: ["Melee", "Ranged", "Durable", "Initiator", "Escape"], weight: 1 }
};
    // 3Ô∏è‚É£ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
    displayPersonalStats();
  } catch (err) {
    console.error("‚ùå OpenDota API error:", err);
  }
}

// –ü–æ–∫–∞–∑—É—î–º–æ 3 –∫–æ–ª–æ–Ω–∫–∏ –∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–º–∏ –≥–µ—Ä–æ—è–º–∏
function displayPersonalStats() {
  const container = document.createElement("div");
  container.id = "personalStats";
  container.innerHTML = `
    <h2 style="text-align:center;margin-top:30px;">–ú–æ—ó –≥–µ—Ä–æ—ó (OpenDota)</h2>
    <div id="personalGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;"></div>
  `;
  document.body.appendChild(container);

  const grid = container.querySelector("#personalGrid");

  const categorized = personalHeroScores.map(h => {
    const hero = heroes.find(x => x.name === h.name);
    const roles = hero?.roles || [];
    const mainRole = getHeroMainCategory({ roles });
    return { ...h, mainRole };
  });

  const carry = categorized.filter(h => h.mainRole === "carry").slice(0, 10);
  const support = categorized.filter(h => h.mainRole === "support").slice(0, 10);
  const universal = categorized.filter(h => h.mainRole === "universal").slice(0, 10);

  function makeColumn(title, color, list) {
    return `
      <div class="pers-col" style="background:#0d1824;padding:10px;border-radius:10px;">
        <h3 style="color:${color};text-align:center;">${title}</h3>
        ${
          list.length
            ? list
                .map(
                  h => `
          <div class="pers-item" style="margin:5px 0;">
            <img src="${heroes.find(x => x.name === h.name)?.img}" width="32" height="32" style="vertical-align:middle;border-radius:6px;margin-right:6px;">
            <strong>${h.name}</strong><br>
            <small>Score: ${h.score.toFixed(1)} | Winrate: ${(h.winrate * 100).toFixed(0)}% | Games: ${h.games}</small>
          </div>`
                )
                .join("")
            : `<p style="opacity:0.6;">(–ø–æ–∫–∏ –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö)</p>`
        }
      </div>`;
  }

  grid.innerHTML =
    makeColumn("‚öî Carry", "#ffcc00", carry) +
    makeColumn("üõ° Support", "#66ff99", support) +
    makeColumn("üîÑ Universal", "#66ccff", universal);
}

// –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener("DOMContentLoaded", loadOpenDotaData);



async function loadData() {
  const steamId = document.getElementById("steamId").value.trim();
  const limit = document.getElementById("matchLimit").value;

  // 1. –õ–æ–∫–∞–ª—å–Ω—ñ –≥–µ—Ä–æ—ó
  const localHeroes = await loadLocalHeroes();

  // 2. API‚Äë–¥–∞–Ω—ñ (–≥–ª–æ–±–∞–ª—å–Ω—ñ –∞–±–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ)
  const apiScores = await getHeroScores(steamId, limit);

  // 3. –ó–º—ñ–∫—Å—É–≤–∞—Ç–∏
  const merged = await mix(localHeroes, apiScores);

  // 4. –í—ñ–¥–º–∞–ª—é–≤–∞—Ç–∏
  renderRecommendations(merged);
}
  
  async function loadLocalHeroes() {
    try {
      const response = await fetch("heroes.json");
      if (!response.ok) throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ heroes.json");
      return await response.json();
    } catch (err) {
      console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ heroes.json:", err);
      return [];
    }
  }

 

  async function init() {
    heroes = await loadLocalHeroes();
    console.log("–ì–µ—Ä–æ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ:", heroes.length);
    // –¥–∞–ª—ñ —Ç–≤—ñ–π –∫–æ–¥ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
  }

  document.addEventListener('DOMContentLoaded', init);
loadOpenDotaData();


  heroes.forEach(h => {
  h.score = (h.winrate * 0.7 + h.pickrate * 0.3);
});


// –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É —Ç–µ–±–µ —î –º–∞—Å–∏–≤ heroes (—è–∫ —É –ø—Ä–∏–∫–ª–∞–¥—ñ –∑ Wraith King)
const carryHeroes = heroes.filter(h => h.roles.includes("Carry") && !h.roles.includes("Support"));
const supportHeroes = heroes.filter(h => h.roles.includes("Support") && !h.roles.includes("Carry"));
const universalHeroes = heroes.filter(h => h.roles.includes("Carry") && h.roles.includes("Support"));
// ====================== –í–ê–ì–ò –†–û–õ–ï–ô ======================
const roleWeights = { Carry: 1.0, Disabler: 0.9, Durable: 0.8, Initiator: 0.9, Escape: 0.6, Nuker: 0.7, Pusher: 0.8, Support: 0.9, Ranged: 0.5, Melee: 0.5 };

// ====================== –ï–¢–ê–ü–ò ======================
const stageLimits = [ { my: 2, enemy: 2 }, { my: 2, enemy: 2 }, { my: 1, enemy: 1 } ];


// ====================== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ======================
document.addEventListener('DOMContentLoaded', () => { createSelectors(); updateTeamDisplays()});

 

// ====================== –°–ï–õ–ï–ö–¢–û–†–ò ======================
function createSelectors(savedMy = [], savedEnemy = []) {
  const myTeamDiv = document.getElementById('myTeam');
  const enemyTeamDiv = document.getElementById('enemyTeam');
  myTeamDiv.innerHTML = "<h2>–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</h2>";
  enemyTeamDiv.innerHTML = "<h2>–°—É–ø–µ—Ä–Ω–∏–∫</h2>";
  const limits = stageLimits[stage - 1];

  createTeamSelectors(myTeamDiv, limits.my, savedMy);
  createTeamSelectors(enemyTeamDiv, limits.enemy, savedEnemy);
  updateSelects();
  document.getElementById('nextBtn').onclick = nextStage;
}

function createTeamSelectors(container, count, saved = []) {
  const heroOptions = ['<option value="">–í–∏–±–µ—Ä–∏ –≥–µ—Ä–æ—è</option>']
    .concat(heroes.map(h => `<option value="${h.name}">${h.name}</option>`))
    .join('');
  for (let i = 0; i < count; i++) {
    const wrapper = document.createElement('div');
    const input = document.createElement('input');
    const select = document.createElement('select');
    select.innerHTML = heroOptions;

    if (saved[i]) select.value = saved[i];

    // üîç –∞–≤—Ç–æ–ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ
    input.placeholder = '–ü–∏—à–∏ –≥–µ—Ä–æ—è...';
    input.addEventListener('input', () => {
      const val = input.value.trim().toLowerCase();
      const opt = Array.from(select.options).find(o => o.text.toLowerCase().startsWith(val));
      if (opt) {
        select.value = opt.value;
        select.style.background = '#ffd700';
        setTimeout(() => select.style.background = '', 400);
      }
      updateSelects();
      updateTeamDisplays();
    });

    select.addEventListener('change', () => {
      input.value = select.value;
      updateSelects();
      updateTeamDisplays();
    });

    wrapper.appendChild(input);
    wrapper.appendChild(select);
    container.appendChild(wrapper);
  }
}

// ====================== –ë–õ–û–ö–£–í–ê–ù–ù–Ø –ü–û–í–¢–û–†–Ü–í ======================
function updateSelects() {
  const selects = Array.from(document.querySelectorAll('select'));
  const selectedCurrentStage = [
    ...getSelectedHeroes('#myTeam'),
    ...getSelectedHeroes('#enemyTeam')
  ];

  // –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ –≥–µ—Ä–æ—ó –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Å—Ç–∞–¥—ñ–π
  const lockedHeroes = new Set([...allMyHeroes, ...allEnemyHeroes]);

  selects.forEach(select => {
    const current = select.value;

    // –ë—É–¥—É—î–º–æ —Å–ø–∏—Å–æ–∫ –æ–ø—Ü—ñ–π: –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ —Ç—ñ, —â–æ –Ω–µ locked —ñ –Ω–µ –≤–∏–±—Ä–∞–Ω—ñ —ñ–Ω—à–∏–º–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–∞–¥—ñ—ó
    const optionsHtml = ['<option value="">–í–∏–±–µ—Ä–∏ –≥–µ—Ä–æ—è</option>'].concat(
      heroes
        .filter(h => {
          // –∑–∞–ª–∏—à–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–æ —É —Å–ø–∏—Å–∫—É selectedCurrentStage (—â–æ–± –Ω–µ —Å–∫–∏–¥–∞—Ç–∏)
          if (current && h.name === current) return true;
          // –±–ª–æ–∫—É—î–º–æ –≥–µ—Ä–æ—ó–≤ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Å—Ç–∞–¥—ñ–π (locked)
          if (lockedHeroes.has(h.name)) return false;
          // –±–ª–æ–∫—É—î–º–æ –≥–µ—Ä–æ—ó–≤, —É–∂–µ –≤–∏–±—Ä–∞–Ω–∏—Ö —ñ–Ω—à–∏–º–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–∞–¥—ñ—ó
          if (selectedCurrentStage.includes(h.name)) return false;
          return true;
        })
        .map(h => `<option value="${h.name}">${h.name}</option>`)
    ).join('');

    select.innerHTML = optionsHtml;

    // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —è–∫—â–æ –≤–æ–Ω–æ —â–µ –¥–æ—Å—Ç—É–ø–Ω–µ
    if (current) select.value = current;
  });
}
  


// ====================== –í–ê–ì–ò –°–¢–ê–î–Ü–ô ======================
function getWeightsByStage(stage) {
  switch (stage) {
    case 1: return { synergy: 0.4, counters: 0.25, winrate: 0.15, pickrate: 0.1, roles: 0.1 };
    case 2: return { synergy: 0.3, counters: 0.3, winrate: 0.2, pickrate: 0.1, roles: 0.1 };
    default: return { synergy: 0.2, counters: 0.45, winrate: 0.15, pickrate: 0.05, roles: 0.15 };
  }
}

// ====================== –î–û–ü–û–ú–Ü–ñ–ù–Ü ======================
function getSelectedHeroes(selector) {
  return Array.from(document.querySelectorAll(selector + ' select'))
    .map(s => s.value).filter(v => v !== '');
}
  function updateTeamDisplays(currentOnly = true) {
    const myTeamList = document.getElementById('myTeamList');
    const enemyTeamList = document.getElementById('enemyTeamList');

    const myHeroes = currentOnly ? getSelectedHeroes('#myTeam') : allMyHeroes;
    const enemyHeroes = currentOnly ? getSelectedHeroes('#enemyTeam') : allEnemyHeroes;

    myTeamList.innerHTML = myHeroes.length
        ? myHeroes.map(h => `<li style="margin:4px 0;">üü© ${h}</li>`).join('')
        : '<li style="opacity:0.6;">(–ø–æ–∫–∏ –Ω–µ –≤–∏–±—Ä–∞–Ω–æ)</li>';

    enemyTeamList.innerHTML = enemyHeroes.length
        ? enemyHeroes.map(h => `<li style="margin:4px 0;">üü• ${h}</li>`).join('')
        : '<li style="opacity:0.6;">(–ø–æ–∫–∏ –Ω–µ –≤–∏–±—Ä–∞–Ω–æ)</li>';
}




// ====================== –ü–û–í–ï–î–Ü–ù–ö–û–í–Ü –§–ê–ö–¢–û–†–ò ======================
function getTeamHarmony(myHeroes) {
  const roleCount = {};
  myHeroes.forEach(h => {
    const hero = heroes.find(x => x.name === h);
    if (hero) hero.roles.forEach(r => roleCount[r] = (roleCount[r] || 0) + 1);
  });
  const carryDup = Math.max(0, (roleCount['Carry'] || 0) - 1);
  const supportDup = Math.max(0, (roleCount['Support'] || 0) - 1);
  return 1 - 0.15 * (carryDup + supportDup);
}

function getToxicityRisk(hero) {
  const toxicHeroes = ['Invoker', 'Meepo', 'Tinker', 'Techies', 'Broodmother'];
  return toxicHeroes.includes(hero.name) ? 0.9 : 1.0;
}

function getPlayerStability() {
  return Math.random() * 0.4 + 0.6; // 0.6‚Äì1.0
}

function getRandomPlayerInfluence() {
  const profiles = [
    { type: "booster", influence: +0.2 },
    { type: "smurf", influence: +0.1 },
    { type: "ruiner", influence: -0.3 },
    { type: "tilter", influence: -0.15 },
    { type: "calm", influence: +0.05 },
  ];
  const avgInfluence = Array.from({length:5},()=>profiles[Math.floor(Math.random()*profiles.length)].influence)
    .reduce((a,b)=>a+b,0)/5;
  return avgInfluence;
}

// ====================== –†–û–ó–†–ê–•–£–ù–û–ö ======================
function calculateBestPicks() {
  const myHeroes = [...allMyHeroes, ...getSelectedHeroes('#myTeam')];
  const enemyHeroes = [...allEnemyHeroes, ...getSelectedHeroes('#enemyTeam')];
  const stageNow = Math.min(stage, 3);
  const weights = getWeightsByStage(stageNow);
  const keyRoles = ['Carry', 'Support', 'Disabler', 'Initiator'];
  const stageRoleMultiplier = stageNow === 1 ? 1.2 : stageNow === 2 ? 1.1 : 1.0;

  const roleCount = {};
  myHeroes.forEach(my => {
    const h = heroes.find(x => x.name === my);
    if (h) h.roles.forEach(r => roleCount[r] = (roleCount[r] || 0) + 1);
  });

  function getSynergyScore(hero) {
    let score = 0;
    myHeroes.forEach(my => {
      const ally = heroes.find(h => h.name === my);
      if (ally) ally.roles.forEach(r => { if (hero.roles.includes(r)) { let m = keyRoles.includes(r)?stageRoleMultiplier:1; score += (roleWeights[r]||1)*m; }});
    });
    return score;
  }

  function getDuplicatePenalty(hero) {
    let penalty = 0;
    hero.roles.forEach(r => { if (roleCount[r] && roleCount[r]>1) penalty += (roleWeights[r]||1)*(roleCount[r]-1); });
    return penalty;
  }

  function getMissingRoleBonus(hero) {
    let bonus = 0;
    Object.keys(roleWeights).forEach(r => {
      if (!roleCount[r] && hero.roles.includes(r)) { let m = keyRoles.includes(r)?stageRoleMultiplier:1; bonus += roleWeights[r]*m; }
    });
    return bonus;
  }

  function getAdaptiveCounterScore(hero) {
    if (!enemyHeroes.length) return 0;
    let score = 0;
    enemyHeroes.forEach(enemy => {
      const enemyHero = heroes.find(h=>h.name===enemy);
      if(!enemyHero) return;
      if(hero.BestCounters?.includes(enemy)) score += 2.0;
      if(hero.commonCounters?.includes(enemy)) score += 1.0;
    });
    if(hero.roles.some(r=>keyRoles.includes(r))) score *= stageRoleMultiplier;
    return score;
  }

  const behaviorMode = document.getElementById('behaviorMode').checked;
  const stability = behaviorMode ? getPlayerStability() : 1.0;
  const influence = behaviorMode ? getRandomPlayerInfluence() : 0.0;
  const harmony = behaviorMode ? getTeamHarmony(myHeroes) : 1.0;

  let scores = [];
  heroes.forEach(hero => {
    if (myHeroes.includes(hero.name) || enemyHeroes.includes(hero.name)) return;
    let score = 0;
    const winNorm = (hero.winrate-0.5)/0.5;
    const pickNorm = Math.log(1+hero.pickrate*100)/Math.log(101);
    score += weights.winrate*winNorm + weights.pickrate*pickNorm;
    score += getAdaptiveCounterScore(hero)*weights.counters;
    score += getSynergyScore(hero)*weights.synergy;
    score -= getDuplicatePenalty(hero);
    score += getMissingRoleBonus(hero)*weights.roles;
// üîπ –î–æ–¥–∞—î–º–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π OpenDota-–≤–ø–ª–∏–≤
if (window.personalHeroScores?.length) {
  const personal = getPersonalScore(hero.name); // 0‚Äì1
  const personalWeight = 0.2; // –≤–ø–ª–∏–≤ 20% –Ω–∞ –∑–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª
  score += personal * personalWeight;
}
    // –∑–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤—ñ —Ñ–∞–∫—Ç–æ—Ä–∏
    if (behaviorMode) {
      score *= getToxicityRisk(hero);
      score *= harmony;
      score *= stability;
      score *= (1 + influence);
    }

    scores.push({hero: hero.name, score: Number(score.toFixed(4))});
  });

  scores.sort((a,b)=>b.score-a.score);
  displayTop(scores);
}
  function showBehaviorInfo() {
  const behaviorMode = document.getElementById('behaviorMode').checked;
  const behaviorDiv = document.getElementById('behaviorInfo');

  if (!behaviorMode) {
    behaviorDiv.style.display = 'none';
    return;
  }

  // –ì–µ–Ω–µ—Ä—É—î–º–æ —Ñ–∞–∫—Ç–æ—Ä–∏
  const stability = getPlayerStability();
  const influence = getRandomPlayerInfluence();
  const harmony = getTeamHarmony([...allMyHeroes, ...getSelectedHeroes('#myTeam')]);

  behaviorDiv.innerHTML = `
    <h3>–ü–æ–≤–µ–¥—ñ–Ω–∫–æ–≤—ñ —Ñ–∞–∫—Ç–æ—Ä–∏</h3>
    <ul>
      <li>–†–∏–∑–∏–∫ —Ç–æ–∫—Å–∏—á–Ω–∏—Ö –≥–µ—Ä–æ—ó–≤: ${ (getToxicityRisk({name:'Invoker'})*100).toFixed(0) }% (–ø—Ä–∏–∫–ª–∞–¥)</li>
      <li>–ì–∞—Ä–º–æ–Ω—ñ—è –∫–æ–º–∞–Ω–¥–∏: ${(harmony*100).toFixed(0)}%</li>
      <li>–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—è: ${(stability*100).toFixed(0)}%</li>
      <li>–í–ø–ª–∏–≤ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é: ${(influence*100).toFixed(0)}%</li>
    </ul>
  `;
  behaviorDiv.style.display = 'block';
}

// ====================== –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø ======================
// –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ –≤–∞–≥–∞–º–∏
// –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ –≤–∞–≥–∞–º–∏
// –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ –≤–∞–≥–∞–º–∏


function getCategory(role) {
  for (const [cat, data] of Object.entries(roleCategories)) {
    if (data.roles.includes(role)) return cat;
  }
  return null;
}

function calculateHeroWeight(hero) {
  const result = { carry: 0, support: 0, universal: 0, total: 0 };
  hero.roles.forEach(role => {
    const cat = getCategory(role);
    if (cat) {
      const w = roleCategories[cat].weight;
      result[cat] += w;
      result.total += w;
    }
  });
  return result;
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –≥–µ—Ä–æ—è
function getHeroMainCategory(hero) {
  const w = calculateHeroWeight(hero);
  const max = Math.max(w.carry, w.support, w.universal);
  if (max === 0) return 'universal'; // —è–∫—â–æ —Ä–æ–ª–µ–π –Ω–µ–º–∞—î

  // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω–Ω—è—Ö
  if (w.carry === max) return 'carry';
  if (w.support === max) return 'support';
  return 'universal';
}

function displayTop(scores) {
  const resultDiv = document.getElementById('results');
  const topHeroes = scores.slice(0, 30); // –∑–∞–ø–∞—Å

  // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∫–æ–∂–Ω–æ–≥–æ –≥–µ—Ä–æ—è
  const categorized = topHeroes.map(t => {
    const hero = heroes.find(h => h.name === t.hero);
    const category = hero ? getHeroMainCategory(hero) : 'universal';
    return { ...t, category };
  });

  // –†–æ–∑–ø–æ–¥—ñ–ª—è—î–º–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
  const carryHeroes = categorized.filter(h => h.category === 'carry').slice(0, 5);
  const supportHeroes = categorized.filter(h => h.category === 'support').slice(0, 5);
  const universalHeroes = categorized.filter(h => h.category === 'universal').slice(0, 5);

  // HTML-–≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
  resultDiv.innerHTML = `
  <h2 style="text-align:center; margin-bottom:15px;">–¢–æ–ø –≥–µ—Ä–æ—ó –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø—ñ–∫—É</h2>
  <div id="resultsGrid">
    <!-- Carry -->
    <div class="resultColumn">
      <h3 style="color:#ffcc00;">‚öî Carry</h3>
      ${
        carryHeroes.length
          ? carryHeroes.map(t => {
              const hero = heroes.find(h => h.name === t.hero);
              const w = calculateHeroWeight(hero);
              return `<div class="hero">
                        <strong>${t.hero}</strong><br>
                        <small>–ë–∞–ª–∏: ${t.score.toFixed(3)} | Carry: ${w.carry}</small>
                      </div>`;
            }).join('')
          : '<p style="opacity:0.6;">(–Ω–µ–º–∞—î Carry —Å–µ—Ä–µ–¥ —Ç–æ–ø—ñ–≤)</p>'
      }
    </div>

    <!-- Support -->
    <div class="resultColumn">
      <h3 style="color:#66ff99;">üõ° Support</h3>
      ${
        supportHeroes.length
          ? supportHeroes.map(t => {
              const hero = heroes.find(h => h.name === t.hero);
              const w = calculateHeroWeight(hero);
              return `<div class="hero">
                        <strong>${t.hero}</strong><br>
                        <small>–ë–∞–ª–∏: ${t.score.toFixed(3)} | Support: ${w.support}</small>
                      </div>`;
            }).join('')
          : '<p style="opacity:0.6;">(–Ω–µ–º–∞—î Support —Å–µ—Ä–µ–¥ —Ç–æ–ø—ñ–≤)</p>'
      }
    </div>

    <!-- Universal -->
    <div class="resultColumn">
      <h3 style="color:#66ccff;">üîÑ –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ</h3>
      ${
        universalHeroes.length
          ? universalHeroes.map(t => {
              const hero = heroes.find(h => h.name === t.hero);
              const w = calculateHeroWeight(hero);
              return `<div class="hero" style="box-shadow:0 0 10px #66ccff;">
                        <strong>${t.hero}</strong><br>
                        <small>–ë–∞–ª–∏: ${t.score.toFixed(3)} | Carry: ${w.carry}, Support: ${w.support}, Univ: ${w.universal}</small>
                      </div>`;
            }).join('')
          : '<p style="opacity:0.6;">(–Ω–µ–º–∞—î —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏—Ö —Å–µ—Ä–µ–¥ —Ç–æ–ø—ñ–≤)</p>'
      }
    </div>
  </div>
  `;
}


// ====================== –ï–¢–ê–ü–ò ======================
let stage = 1;
let allMyHeroes = [];
let allEnemyHeroes = [];

function nextStage() {
    const mySelected = getSelectedHeroes('#myTeam');
    const enemySelected = getSelectedHeroes('#enemyTeam');
    const limits = stageLimits[stage - 1];
  const stageTitle = document.getElementById('stageTitle');
function updateStageTitle() {
  stageTitle.textContent = `Stage ${stage}`;
}

    // –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –æ–±—Ä–∞–Ω–æ –ø–æ—Ç—Ä—ñ–±–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–µ—Ä–æ—ó–≤
    if (mySelected.length < limits.my || enemySelected.length < limits.enemy) {
        alert(`‚ö†Ô∏è –û–±–µ—Ä–∏ ${limits.my} –≥–µ—Ä–æ—ó–≤ —É —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É —Ç–∞ ${limits.enemy} —É —Å—É–ø–µ—Ä–Ω–∏–∫–∞!`);
        return;
    }

    // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—Ä–∞–Ω–∏—Ö –≥–µ—Ä–æ—ó–≤
    allMyHeroes.push(...mySelected);
    allEnemyHeroes.push(...enemySelected);

    if (stage < 3) {
        stage++; // –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–∞–¥—ñ—é
      updateStageTitle();
        updateTeamDisplays(false);
        createSelectors([], []); // —Å—Ç–≤–æ—Ä—é—î–º–æ —á–∏—Å—Ç—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –¥–ª—è –Ω–æ–≤–æ—ó —Å—Ç–∞–¥—ñ—ó
       calculateBestPicks();
showBehaviorInfo();
    } else {
        showFinalChance(); // —Ñ—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç–∞–¥—ñ—è
    }
}







// ====================== –§–Ü–ù–ê–õ ======================
// ====================== –§–Ü–ù–ê–õ ======================
function showFinalChance() {
    const myTeam = allMyHeroes;
    const enemyTeam = allEnemyHeroes;

    let myScore = 0, enemyScore = 0;

    heroes.forEach(h => {
        if (myTeam.includes(h.name)) {
            enemyTeam.forEach(e => {
                if (h.BestCounters?.includes(e)) myScore += 2;
                if (h.commonCounters?.includes(e)) myScore += 1;
            });
            myScore += h.winrate; // –¥–æ–¥–∞—î–º–æ winrate
        }
        if (enemyTeam.includes(h.name)) {
            myTeam.forEach(m => {
                if (h.BestCounters?.includes(m)) enemyScore += 2;
                if (h.commonCounters?.includes(m)) enemyScore += 1;
            });
            enemyScore += h.winrate;
        }
    });

    // —Å–∏–Ω–µ—Ä–≥—ñ—è –∫–æ–º–∞–Ω–¥
    myScore *= getTeamHarmony(myTeam);
    enemyScore *= getTeamHarmony(enemyTeam);

    let myChance = (myScore + enemyScore > 0) ? (myScore / (myScore + enemyScore)) * 100 : 50;

    // –ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤—ñ —Ñ–∞–∫—Ç–æ—Ä–∏
    if (document.getElementById('behaviorMode').checked){
        const stability = getPlayerStability();
        const influence = getRandomPlayerInfluence();
        myChance *= stability * (1 + influence);
        myChance = Math.max(5, Math.min(95, myChance));
    }

    // –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
    document.getElementById('summaryMyTeam').innerHTML = myTeam.map(h=>`<li>üü© ${h}</li>`).join('');
    document.getElementById('summaryEnemyTeam').innerHTML = enemyTeam.map(h=>`<li>üü• ${h}</li>`).join('');
    document.getElementById('summaryChance').textContent = `–®–∞–Ω—Å –Ω–∞ –ø–µ—Ä–µ–º–æ–≥—É: ${myChance.toFixed(0)}%`;
    document.getElementById('summaryBar').style.width = `${myChance}%`;
    document.getElementById('draftSummary').style.display = 'block';
    document.getElementById('results').style.display = 'none';
  // –ø–æ–∫–∞–∑—É—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
document.getElementById('draftSummary').style.display = 'block';

// —Ö–æ–≤–∞—î–º–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ —Ç–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞–¥—ñ—ó
document.getElementById('selectorsContainer').style.display = 'none';
document.getElementById('stageTitle').style.display = 'none';
document.getElementById('results').style.display = 'none';
document.getElementById('teamsDisplay').style.display = 'none';
document.getElementById('controls').style.display = 'none';
  // —Ç–µ–∫—Å—Ç
document.getElementById('summaryChance').textContent = `–®–∞–Ω—Å –Ω–∞ –ø–µ—Ä–µ–º–æ–≥—É: ${myChance.toFixed(0)}%`;

// —à–∫–∞–ª–∞
const bar = document.getElementById("summaryBar");
bar.style.width = `${myChance}%`;

if (myChance <= 45) {
  bar.style.background = "#f44336"; // —á–µ—Ä–≤–æ–Ω–∏–π
} else if (myChance < 55) {
  bar.style.background = "#ffeb3b"; // –∂–æ–≤—Ç–∏–π
} else {
  bar.style.background = "#4caf50"; // –∑–µ–ª–µ–Ω–∏–π
}

// –ø–æ–∫–∞–∑—É—î–º–æ –±–ª–æ–∫
document.getElementById('draftSummary').style.display = 'block';
document.getElementById('results').style.display = 'none';
 






    updateTeamDisplays(false); // –∑–∞–ª–∏—à–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ –≤–∏–±—Ä–∞–Ω—ñ –≥–µ—Ä–æ—ó –≤ —Å–ø–∏—Å–∫–∞—Ö
}
 
// ========== –ü–Ü–î–¢–Ø–ì–£–Ñ–ú–û –ú–û–á–• –ì–ï–†–û–á–í –ó OPENDOTA ==========

</script>
</body>
</html>
