<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dota2 Draft ‚Äî –†–æ–ª—å ‚Üí –î—Ä–∞—Ñ—Ç ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç (10 —Å–ª–æ—Ç—ñ–≤)</title>
  <style>
    :root{
      --bg:#0b0b0b; --panel:#171717; --muted:#9aa1a8; --accent:#4caf50; --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{margin:0;padding:22px;font-family:Inter,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#070707,#121212);color:#e6eef3}
    .screen{max-width:1200px;margin:0 auto}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    header h1{margin:0;font-size:20px}
    .card{background:var(--panel);border-radius:10px;padding:14px;}
    .muted{color:var(--muted);font-size:13px}
    .roles{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:18px}
    .role-btn{padding:10px 16px;border-radius:8px;background:var(--glass);color:var(--muted);cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .role-btn.active{background:linear-gradient(90deg,#2b7a3a,#178a6a);color:#fff;box-shadow:0 6px 18px rgba(23,138,106,0.16)}
    .stage{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:13px}
    /* draft layout */
    .draft-grid{display:grid;grid-template-columns:1fr 420px 1fr;gap:16px;margin-top:16px;align-items:start}
    .team-col{min-height:240px;padding:12px;border-radius:8px;background:linear-gradient(180deg,#121212,#171717);border:1px solid rgba(255,255,255,0.02)}
    .team-title{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .slots{display:flex;flex-direction:column;gap:8px}
    .slot{display:flex;align-items:center;gap:10px;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .slot.active{box-shadow:0 6px 18px rgba(0,0,0,0.6), inset 0 0 0 2px rgba(76,175,80,0.14)}
    .hero-thumb{width:46px;height:26px;border-radius:4px;overflow:hidden;background:#0c0c0c}
    .hero-thumb img{width:100%;height:100%;object-fit:cover}
    .hero-name{flex:1}
    .pick-btn{padding:6px 10px;border-radius:6px;border:none;background:linear-gradient(90deg,#2b7a3a,#178a6a);color:white;cursor:pointer}
    .pick-btn.secondary{background:#2b2b2b;border:1px solid rgba(255,255,255,0.03)}
    /* picker */
    .picker{background:var(--panel);padding:12px;border-radius:8px;max-height:640px;overflow:auto}
    .picker .filter-row{display:flex;gap:8px;margin-bottom:10px}
    .hero-list{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .hero-item{display:flex;gap:8px;align-items:center;padding:6px;border-radius:6px;background:rgba(255,255,255,0.01);cursor:pointer}
    .hero-item.disabled{opacity:0.35;pointer-events:none}
    .hero-item img{width:40px;height:24px;object-fit:cover;border-radius:4px}
    .tiny{font-size:12px;color:var(--muted)}
    /* right panel */
    .panel{padding:12px;border-radius:8px;background:linear-gradient(180deg,#0f1111,#131313);border:1px solid rgba(255,255,255,0.02)}
    .suggestions{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .suggestion{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}
    .score{min-width:48px;text-align:right;font-weight:600}
    .results{margin-top:12px;padding:12px;border-radius:8px;background:linear-gradient(180deg,#0f1410,#091213);border:1px solid rgba(255,255,255,0.02)}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    .flex{display:flex;gap:8px;align-items:center}
    .center{display:flex;align-items:center;justify-content:center}
    .btn{padding:8px 12px;border-radius:8px;background:var(--accent);border:none;color:#fff;cursor:pointer}
    .btn.secondary{background:#2b2b2b;border:1px solid rgba(255,255,255,0.03)}
  </style>
</head>
<body>
  <div class="screen">
    <header>
      <h1>Dota 2 ‚Äî Draft Simulator (—Ä—É—á–Ω–æ –æ–±–∏—Ä–∞—î—à —É—Å—ñ—Ö 10)</h1>
      <div style="margin-left:auto" class="muted">–î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö: OpenDota API</div>
    </header>

    <!-- Role select -->
    <div id="role-screen" class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="tiny">–ö–†–û–ö 1</div>
          <h2>–û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å, –∑–∞ —è–∫—É –≤–∏ –±—É–¥–µ—Ç–µ –≥—Ä–∞—Ç–∏</h2>
        </div>
        <div class="stage">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∏–±—ñ—Ä —Ä–æ–ª—ñ</div>
      </div>

      <div class="roles" id="roles-container"></div>

      <div style="display:flex;justify-content:center;margin-top:16px;gap:12px">
        <button id="start-draft" class="btn" disabled>Start Draft</button>
        <button id="random-role" class="btn secondary">–í–∏–ø–∞–¥–∫–æ–≤–∞ —Ä–æ–ª—å</button>
      </div>
      <p class="tiny center" style="margin-top:12px">–ü—ñ—Å–ª—è Start Draft ‚Äî –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –µ–∫—Ä–∞–Ω –¥—Ä–∞—Ñ—Ç—É. –ù–∞—Ç–∏—Å–Ω–∏ Pick —É –ø–æ—Ç—Ä—ñ–±–Ω–æ–º—É —Å–ª–æ—Ç—ñ (–≤ —Å–≤–æ—ó–π –∞–±–æ –≤–æ—Ä–æ–∂—ñ–π –∫–æ–º–∞–Ω–¥—ñ), –∞ –ø–æ—Ç—ñ–º –≤–∏–±–µ—Ä–∏ –≥–µ—Ä–æ—è –∑ –ø—Ä–∞–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞.</p>
    </div>

    <!-- Draft -->
    <div id="draft-screen" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div class="tiny">–ö–†–û–ö 2 ‚Äî –î—Ä–∞—Ñ—Ç (–≤—Ä—É—á–Ω—É –∑–∞ –æ–±–∏–¥–≤—ñ –∫–æ–º–∞–Ω–¥–∏)</div>
        <div class="stage" id="stage-indicator">Draft stage</div>
      </div>

      <div class="draft-grid">
        <!-- My team -->
        <div class="team-col card">
          <div class="team-title"><strong>–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</strong><div style="margin-left:auto" class="tiny">–†–æ–ª—å: <span id="player-role-label">‚Äî</span></div></div>
          <div class="slots" id="my-slots"></div>
        </div>

        <!-- picker center -->
        <div>
          <div class="picker card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <div>
                <div class="tiny">Hero picker</div>
                <div style="font-weight:600" id="picker-context">–û–±–µ—Ä—ñ—Ç—å —Å–ª–æ—Ç (Pick) –∑–ª—ñ–≤–∞ –∞–±–æ —Å–ø—Ä–∞–≤–∞</div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <div class="tiny">–ü–æ—à—É–∫</div>
                <input id="hero-search" placeholder="–§—ñ–ª—å—Ç—Ä..." style="background:#0f0f0f;border-radius:6px;border:1px solid rgba(255,255,255,0.03);padding:6px;color:#fff" />
              </div>
            </div>

            <div class="filter-row" style="margin-bottom:10px">
              <select id="role-filter" style="flex:1;padding:8px;border-radius:6px;background:#0f0f0f;color:#fff;border:1px solid rgba(255,255,255,0.03)">
                <option value="">–í—Å—ñ —Ä–æ–ª—ñ</option>
              </select>
              <button id="clear-filter" class="btn secondary">–û—á–∏—Å—Ç–∏—Ç–∏</button>
            </div>

            <div class="hero-list" id="hero-list"></div>

            <div style="margin-top:10px" class="tiny">–Ü–∫–æ–Ω–∫–∏ –≥–µ—Ä–æ—ó–≤ ‚Äî OpenDota. –û–±—Ä–∞–Ω–∏–π –≥–µ—Ä–æ–π –≤–∏–∫–ª—é—á–∞—î—Ç—å—Å—è –∑ —Å–ø–∏—Å–∫–∞.</div>
          </div>

          <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
            <button id="reset-picks" class="btn secondary">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø—ñ–∫–∏</button>
            <button id="finish-draft" class="btn">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –¥—Ä–∞—Ñ—Ç</button>
          </div>
        </div>

        <!-- enemy -->
        <div class="team-col card">
          <div class="team-title"><strong>–°—É–ø–µ—Ä–Ω–∏–∫</strong><div style="margin-left:auto" class="tiny">–í–∞—à—ñ –∫–æ–Ω—Ç—Ä–ø—ñ–∫–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –ø—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –≤–æ—Ä–æ–≥–∞</div></div>
          <div class="slots" id="enemy-slots"></div>
        </div>
      </div>

      <!-- Right panel (suggestions moved here for clarity) -->
      <div style="display:flex;gap:16px;margin-top:14px">
        <div style="flex:1" class="panel card">
          <h3>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –∫–æ–Ω—Ç—Ä–ø—ñ–∫–∏ –¥–ª—è –≤–∞—à–æ—ó —Ä–æ–ª—ñ</h3>
          <div class="tiny">–û–Ω–æ–≤–ª—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É –≤–æ—Ä–æ–≥–∞. –ë–∞–∑—É—é—Ç—å—Å—è –Ω–∞ –¥–∞–Ω–∏—Ö OpenDota matchups.</div>
          <div id="suggestions" class="suggestions"></div>

          <div class="results" id="live-analysis">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="tiny">–ü–æ—Ç–æ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</div>
              <div class="tiny">–®–∞–Ω—Å (–æ—Ä—ñ—î–Ω—Ç–∏—Ä)</div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
              <div style="flex:1">
                <div id="analysis-text" class="tiny">–ü–æ—á–Ω—ñ—Ç—å –≤–∏–±–∏—Ä–∞—Ç–∏ –ø—ñ–∫–∏ ‚Äî —Ç—É—Ç –∑'—è–≤–∏—Ç—å—Å—è –∞–Ω–∞–ª—ñ–∑.</div>
              </div>
              <div style="width:120px;text-align:right">
                <div id="win-estimate" style="font-weight:700;font-size:20px">‚Äî</div>
                <div class="tiny" style="color:var(--muted)">–ü—Ä–∏–±–ª–∏–∑–Ω–æ</div>
              </div>
            </div>
          </div>
        </div>

        <div style="width:300px" class="panel card">
          <h3>–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å</h3>
          <div class="tiny">–ú–æ—ó –ø—ñ–∫–∏</div>
          <div id="mini-my" style="margin-bottom:8px"></div>
          <div class="tiny">–í–æ—Ä–æ–∂—ñ –ø—ñ–∫–∏</div>
          <div id="mini-enemy"></div>
        </div>
      </div>
    </div>

    <!-- results -->
    <div id="results-screen" style="display:none;margin-top:14px">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –¥—Ä–∞—Ñ—Ç—É</h2>
            <div class="tiny">–ê–Ω–∞–ª—ñ–∑ –ø—ñ–∫/–∫–æ–Ω—Ç—Ä–ø—ñ–∫ —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–∏–π —à–∞–Ω—Å (—Å–∏–º—É–ª—è—Ü—ñ—è)</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:22px;font-weight:700" id="final-win">‚Äî</div>
            <div class="tiny" id="final-strategy">‚Äî</div>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <div style="flex:1" class="team-col card">
            <strong>–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</strong>
            <div id="final-my" style="margin-top:8px"></div>
          </div>
          <div style="flex:1" class="team-col card">
            <strong>–°—É–ø–µ—Ä–Ω–∏–∫</strong>
            <div id="final-enemy" style="margin-top:8px"></div>
          </div>
        </div>

        <div style="margin-top:12px">
          <h3>–ö–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–∞–ª—ñ–∑</h3>
          <div id="final-analysis" class="tiny"></div>
        </div>

        <div style="margin-top:12px" class="center">
          <button id="restart" class="btn secondary">–ü–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É</button>
        </div>
      </div>
    </div>

    <footer>Made with ‚ù§Ô∏è ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î OpenDota API –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–∞—Ç—á–∞–ø—ñ–≤. –Ø–∫—â–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –∑ –ª–æ–∫–∞–ª—å–Ω–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏.</footer>
  </div>

<script>
(async function(){

/* ============================
   –ö–æ–Ω—Ñ—ñ–≥ (—Ä–æ–ª—å–æ–≤—ñ —Å–ø–∏—Å–∫–∏)
   ============================ */

const roleHeroes = {
  Carry: ["Phantom Assassin","Juggernaut","Sven","Morphling","Faceless Void","Medusa","Spectre","Anti-Mage","Weaver","Lifestealer","Drow Ranger","Terrorblade"],
  Mid: ["Invoker","Storm Spirit","Puck","Queen of Pain","Shadow Fiend","Ember Spirit","Tinker","Leshrac","Zeus","Death Prophet","Kunkka","Windranger"],
  Offlane: ["Centaur Warrunner","Tidehunter","Mars","Beastmaster","Dark Seer","Timbersaw","Axe","Bristleback","Underlord","Doom","Magnus","Slardar"],
  "Support 4": ["Rubick","Earth Spirit","Tusk","Mirana","Snapfire","Nyx Assassin","Phoenix","Clockwerk","Marci","Techies","Pudge","Spirit Breaker"],
  "Support 5": ["Crystal Maiden","Lion","Witch Doctor","Dazzle","Omniknight","Warlock","Shadow Shaman","Lich","Oracle","Treant Protector","Bane","Disruptor"]
};

const roleKeys = Object.keys(roleHeroes);

/* ============================
   State
   ============================ */

let allHeroesApi = [];
let heroByName = {};
let heroShort = {};
let picked = { my: Array(5).fill(null), enemy: Array(5).fill(null) };
let playerRole = null;
let activeSlot = null; // {team:'my'|'enemy', index}
let matchupCache = {};

/* ============================
   UI refs
   ============================ */

const rolesContainer = document.getElementById('roles-container');
const startBtn = document.getElementById('start-draft');
const randomRoleBtn = document.getElementById('random-role');
const playerRoleLabel = document.getElementById('player-role-label');

const roleScreen = document.getElementById('role-screen');
const draftScreen = document.getElementById('draft-screen');
const resultsScreen = document.getElementById('results-screen');

const mySlotsEl = document.getElementById('my-slots');
const enemySlotsEl = document.getElementById('enemy-slots');
const heroListEl = document.getElementById('hero-list');
const roleFilter = document.getElementById('role-filter');
const heroSearch = document.getElementById('hero-search');
const clearFilterBtn = document.getElementById('clear-filter');
const pickerContext = document.getElementById('picker-context');
const suggestionsEl = document.getElementById('suggestions');
const winEstimateEl = document.getElementById('win-estimate');
const analysisText = document.getElementById('analysis-text');
const miniMy = document.getElementById('mini-my');
const miniEnemy = document.getElementById('mini-enemy');

const resetPicksBtn = document.getElementById('reset-picks');
const finishDraftBtn = document.getElementById('finish-draft');

const finalMy = document.getElementById('final-my');
const finalEnemy = document.getElementById('final-enemy');
const finalWin = document.getElementById('final-win');
const finalStrategy = document.getElementById('final-strategy');
const finalAnalysis = document.getElementById('final-analysis');
const restartBtn = document.getElementById('restart');

/* ============================
   Init roles UI
   ============================ */

function renderRoleButtons(){
  rolesContainer.innerHTML = '';
  roleKeys.forEach(r=>{
    const b = document.createElement('button');
    b.className = 'role-btn';
    b.textContent = r;
    b.onclick = ()=> {
      document.querySelectorAll('.role-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      playerRole = r;
      startBtn.disabled = false;
      playerRoleLabel.textContent = r;
      updateSuggestions();
    };
    rolesContainer.appendChild(b);
  });
  roleKeys.forEach(r=>{
    const opt = document.createElement('option'); opt.value=r; opt.textContent=r; roleFilter.appendChild(opt);
  });
}
renderRoleButtons();

/* ============================
   Load OpenDota heroes
   ============================ */

async function loadHeroList(){
  try{
    const res = await fetch('https://api.opendota.com/api/heroes');
    const data = await res.json();
    allHeroesApi = data.sort((a,b)=>a.localized_name.localeCompare(b.localized_name));
    allHeroesApi.forEach(h=>{
      heroByName[h.localized_name] = h;
      heroShort[h.localized_name] = h.name.replace('npc_dota_hero_','');
    });
    populateHeroPicker();
  }catch(e){
    console.warn('OpenDota heroes failed, fallback to role list',e);
    // fallback minimal
    const fallback = new Set();
    Object.values(roleHeroes).flat().forEach(n=>fallback.add(n));
    allHeroesApi = Array.from(fallback).map((name,i)=>({
      id: 10000+i, localized_name: name, name: 'npc_dota_hero_'+name.toLowerCase().replace(/\s+/g,'_')
    }));
    allHeroesApi.forEach(h=>{
      heroByName[h.localized_name] = h;
      heroShort[h.localized_name] = h.name.replace('npc_dota_hero_','');
    });
    populateHeroPicker();
  }
}

/* ============================
   Populate hero picker list
   ============================ */

function heroItemHtml(name){
  const short = heroShort[name] || '';
  const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
  return `<div style="display:flex;align-items:center;gap:8px;width:100%"><div style="width:44px;height:26px;border-radius:4px;overflow:hidden"><img src="${img}" alt=""></div><div style="flex:1"><div style="font-weight:600">${name}</div><div class="tiny" style="opacity:0.7">${getRolesForHero(name).join(', ')}</div></div><div class="tiny">pick</div></div>`;
}

function getRolesForHero(name){
  return roleKeys.filter(r=>roleHeroes[r].includes(name));
}

function populateHeroPicker(){
  heroListEl.innerHTML = '';
  const names = allHeroesApi.map(h=>h.localized_name);
  names.forEach(n=>{
    const div = document.createElement('div');
    div.className = 'hero-item';
    div.dataset.name = n;
    div.innerHTML = heroItemHtml(n);
    div.onclick = ()=> tryPickHero(n);
    heroListEl.appendChild(div);
  });
  updateDisabledHeroes();
}

/* ============================
   Slots rendering (both teams)
   ============================ */

function createSlotEl(team, idx){
  const el = document.createElement('div'); el.className='slot'; el.id=`slot-${team}-${idx}`;
  const thumb = document.createElement('div'); thumb.className='hero-thumb';
  const nameWrap = document.createElement('div'); nameWrap.className='hero-name';
  const btn = document.createElement('button'); btn.className='pick-btn'; btn.textContent='Pick';
  const btnClear = document.createElement('button'); btnClear.className='pick-btn secondary'; btnClear.textContent='Clear';

  btn.onclick = ()=> {
    activeSlot = {team, index:idx};
    highlightActiveSlot();
    pickerContext.textContent = `–ü—ñ–∫–∞–π –¥–ª—è ${team === 'my' ? '–ú–æ—ó–π –∫–æ–º–∞–Ω–¥—ñ' : '–í–æ—Ä–æ–≥–∞'} ‚Äî —Å–ª–æ—Ç ${idx+1}`;
    heroSearch.focus();
  };
  btnClear.onclick = ()=> {
    picked[team][idx] = null;
    if(activeSlot && activeSlot.team===team && activeSlot.index===idx) activeSlot=null;
    refreshAll();
  };

  nameWrap.innerHTML = `<div class="tiny">–ü–æ—Ä–æ–∂–Ω—ñ–π —Å–ª–æ—Ç</div>`;
  el.appendChild(thumb); el.appendChild(nameWrap);
  const controls = document.createElement('div'); controls.style.display='flex'; controls.style.gap='6px';
  controls.appendChild(btn); controls.appendChild(btnClear);
  el.appendChild(controls);
  return el;
}

function renderAllSlots(){
  mySlotsEl.innerHTML = ''; enemySlotsEl.innerHTML = '';
  for(let i=0;i<5;i++){
    mySlotsEl.appendChild(createSlotEl('my',i));
  }
  for(let i=0;i<5;i++){
    enemySlotsEl.appendChild(createSlotEl('enemy',i));
  }
  refreshAll();
}

function refreshAll(){
  // update displays
  for(let i=0;i<5;i++){
    updateSlotDisplay('my', i);
    updateSlotDisplay('enemy', i);
  }
  updateDisabledHeroes();
  updateMiniLists();
  updateSuggestions();
  computeLiveEstimate(); // async but ok
}

function updateSlotDisplay(team, idx){
  const el = document.getElementById(`slot-${team}-${idx}`);
  const nameWrap = el.querySelector('.hero-name');
  const thumb = el.querySelector('.hero-thumb');
  const heroName = picked[team][idx];
  if(heroName){
    const short = heroShort[heroName];
    const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
    thumb.innerHTML = `<img src="${img}" alt="">`;
    nameWrap.innerHTML = `<div style="font-weight:700">${heroName}</div><div class="tiny">Roles: ${getRolesForHero(heroName).join(', ')}</div>`;
  } else {
    thumb.innerHTML = '';
    nameWrap.innerHTML = `<div class="tiny">–ü–æ—Ä–æ–∂–Ω—ñ–π —Å–ª–æ—Ç</div>`;
  }
  // highlight active
  el.classList.toggle('active', activeSlot && activeSlot.team===team && activeSlot.index===idx);
}

/* ============================
   Picking logic
   ============================ */

function tryPickHero(name){
  // if no active slot -> choose first empty my slot then enemy slot, prefer my
  if(!activeSlot){
    const nextMy = picked.my.findIndex(x=>!x);
    const nextEnemy = picked.enemy.findIndex(x=>!x);
    if(nextMy !== -1){
      activeSlot = {team:'my', index: nextMy};
    } else if(nextEnemy !== -1){
      activeSlot = {team:'enemy', index: nextEnemy};
    } else {
      alert('–£—Å—ñ —Å–ª–æ—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ. –û—á–∏—Å—Ç—ñ—Ç—å —Å–ª–æ—Ç –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Finish.');
      return;
    }
  }

  // uniqueness
  const chosen = new Set([...picked.my.filter(Boolean), ...picked.enemy.filter(Boolean)]);
  if(chosen.has(name)){
    alert('–¶–µ–π –≥–µ—Ä–æ–π –≤–∂–µ –≤–∏–±—Ä–∞–Ω–∏–π.');
    return;
  }

  picked[activeSlot.team][activeSlot.index] = name;
  activeSlot = null;
  refreshAll();
}

/* ============================
   Disabled heroes UI
   ============================ */

function updateDisabledHeroes(){
  const chosen = new Set([...picked.my.filter(Boolean), ...picked.enemy.filter(Boolean)]);
  document.querySelectorAll('.hero-item').forEach(el=>{
    const n = el.dataset.name;
    if(chosen.has(n)) el.classList.add('disabled'); else el.classList.remove('disabled');
  });
}

/* ============================
   Filters
   ============================ */

roleFilter.addEventListener('change', renderFiltered);
heroSearch.addEventListener('input', renderFiltered);
clearFilterBtn.addEventListener('click', ()=>{ roleFilter.value=''; heroSearch.value=''; renderFiltered(); });

function renderFiltered(){
  const q = heroSearch.value.trim().toLowerCase();
  const r = roleFilter.value;
  document.querySelectorAll('.hero-item').forEach(el=>{
    const n = el.dataset.name;
    const okQ = !q || n.toLowerCase().includes(q);
    const okR = !r || getRolesForHero(n).includes(r);
    el.style.display = (okQ && okR) ? 'flex' : 'none';
  });
  updateDisabledHeroes();
}

/* ============================
   Suggestions & matchups
   ============================ */

async function updateSuggestions(){
  suggestionsEl.innerHTML = '';
  if(!playerRole){
    suggestionsEl.innerHTML = '<div class="tiny">–û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π.</div>'; return;
  }
  const enemyPicks = picked.enemy.filter(Boolean);
  if(enemyPicks.length === 0){
    suggestionsEl.innerHTML = '<div class="tiny">–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± 1 –≤–æ—Ä–æ–∂–∏–π –ø—ñ–∫ ‚Äî —Ç—É—Ç –∑\'—è–≤–ª—è—Ç—å—Å—è –∫–æ–Ω—Ç—Ä–ø—ñ–∫–∏.</div>'; return;
  }
  // candidate pool: all heroes in playerRole not already picked
  const candidates = (roleHeroes[playerRole] || []).filter(n => ![...picked.my,...picked.enemy].includes(n));
  const scores = [];
  for(const cand of candidates){
    const candObj = heroByName[cand];
    const candId = candObj ? candObj.id : null;
    let counterAvg = 0;
    if(candId){
      const matchups = await fetchMatchups(candId);
      let sum = 0, cnt = 0;
      for(const e of enemyPicks){
        const eObj = heroByName[e];
        if(!eObj) continue;
        const entry = matchups.find(x=>x.hero_id === eObj.id);
        const wr = entry ? (entry.wins / entry.games_played) : 0.5;
        sum += wr; cnt++;
      }
      counterAvg = cnt ? (sum / cnt) : 0.5;
    } else counterAvg = 0.5;

    // synergy heuristic with my allies
    let synergy = 0;
    const allies = picked.my.filter(Boolean);
    for(const a of allies){
      if(roleHeroes['Support 5'].includes(a) || roleHeroes['Support 4'].includes(a)){
        if(roleHeroes['Carry'].includes(cand)) synergy += 0.12;
      }
      if((a==='Magnus' && cand==='Faceless Void') || (a==='Faceless Void' && cand==='Magnus')) synergy += 0.22;
      if((a==='Enigma' && cand==='Tidehunter') || (a==='Tidehunter' && cand==='Enigma')) synergy += 0.12;
    }

    const finalScore = (counterAvg * 0.82) + (synergy * 0.18);
    scores.push({hero:cand, counterAvg, synergy, finalScore});
  }

  scores.sort((a,b)=>b.finalScore - a.finalScore);
  scores.slice(0,10).forEach(s=>{
    const row = document.createElement('div'); row.className='suggestion';
    const short = heroShort[s.hero] || '';
    const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
    row.innerHTML = `<div style="width:56px;height:30px;border-radius:6px;overflow:hidden"><img src="${img}" style="width:100%;height:100%;object-fit:cover"></div><div style="flex:1"><div style="font-weight:700">${s.hero}</div><div class="tiny">counter avg ${(s.counterAvg*100).toFixed(0)}% ¬∑ synergy ${(s.synergy*100).toFixed(0)}%</div></div><div class="score">${(s.finalScore*100).toFixed(0)}</div>`;
    row.onclick = ()=> {
      if(!activeSlot){
        alert('–û–±–µ—Ä—ñ—Ç—å —Å–ª–æ—Ç (Pick) –∫—É–¥–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –≥–µ—Ä–æ—è (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Pick –Ω–∞ —Å–ª–æ—Ç–∏ –º–æ—î—ó –∞–±–æ –≤–æ—Ä–æ–∂–æ—ó –∫–æ–º–∞–Ω–¥–∏).');
        return;
      }
      tryPickHero(s.hero);
    };
    suggestionsEl.appendChild(row);
  });

  if(scores.length===0) suggestionsEl.innerHTML = '<div class="tiny">–ù–µ–º–∞—î –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ (–≤—Å—ñ –≥–µ—Ä–æ—ó —Ä–æ–ª—ñ –≤–∂–µ –æ–±—Ä–∞–Ω—ñ –∞–±–æ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–∏–π).</div>';
}

/* ============================
   Matchup fetch + cache
   ============================ */

async function fetchMatchups(heroId){
  if(matchupCache[heroId]) return matchupCache[heroId];
  try{
    const res = await fetch(`https://api.opendota.com/api/heroes/${heroId}/matchups`);
    const data = await res.json();
    data.forEach(d=> d.win_rate = d.games_played ? (d.wins / d.games_played) : 0.5);
    matchupCache[heroId] = data;
    // small throttle
    await new Promise(r=>setTimeout(r,60));
    return data;
  }catch(e){
    console.warn('Matchup fetch failed', e);
    matchupCache[heroId] = [];
    return [];
  }
}

/* ============================
   Live estimate
   ============================ */

async function computeLiveEstimate(){
  const myP = picked.my.filter(Boolean);
  const enP = picked.enemy.filter(Boolean);
  if(myP.length===0 || enP.length===0){
    analysisText.textContent = '–ü–æ—á–Ω—ñ—Ç—å –∑–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏ —Å–ª–æ—Ç–∏ ‚Äî —Ç—É—Ç –∑\'—è–≤–∏—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∞–Ω–∞–ª—ñ–∑.';
    winEstimateEl.textContent = '‚Äî';
    return;
  }

  // myScore: for each my hero, avg winrate vs enemy picks (using my hero matchups)
  let myScore = 0;
  for(const m of myP){
    const mObj = heroByName[m]; if(!mObj) continue;
    const mm = await fetchMatchups(mObj.id);
    let sum = 0, cnt = 0;
    for(const e of enP){
      const eObj = heroByName[e]; if(!eObj) continue;
      const entry = mm.find(x=>x.hero_id===eObj.id);
      const wr = entry ? entry.win_rate : 0.5;
      sum += wr; cnt++;
    }
    if(cnt) myScore += (sum / cnt);
  }
  myScore = myScore / (myP.length || 1);

  // enemy score: for each enemy hero, avg winrate vs my picks (using enemy hero matchups)
  let enScore = 0;
  for(const e of enP){
    const eObj = heroByName[e]; if(!eObj) continue;
    const mm = await fetchMatchups(eObj.id);
    let sum = 0, cnt = 0;
    for(const m of myP){
      const mObj = heroByName[m]; if(!mObj) continue;
      const entry = mm.find(x=>x.hero_id===mObj.id);
      const wr = entry ? entry.win_rate : 0.5;
      sum += wr; cnt++;
    }
    if(cnt) enScore += (sum / cnt);
  }
  enScore = enScore / (enP.length || 1);

  let estimate = 50 + 20 * (myScore - enScore);
  estimate = Math.max(8, Math.min(92, estimate));
  winEstimateEl.textContent = `${estimate.toFixed(0)}%`;

  analysisText.textContent = `–ú–æ—ó –ø—ñ–∫–∏: ${myP.join(', ')}\n–í–æ—Ä–æ–≥–∏: ${enP.join(', ')}\n–ú–æ—è —Å–µ—Ä–µ–¥–Ω—è: ${(myScore*100).toFixed(0)}% ¬∑ –≤–æ—Ä–æ–∂–∞ —Å–µ—Ä–µ–¥–Ω—è: ${(enScore*100).toFixed(0)}%`;
}

/* ============================
   Mini lists display
   ============================ */

function updateMiniLists(){
  miniMy.innerHTML = '';
  miniEnemy.innerHTML = '';
  picked.my.filter(Boolean).forEach(h=>{
    const short = heroShort[h] || ''; const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
    const d = document.createElement('div'); d.className='flex'; d.style.marginBottom='6px';
    d.innerHTML = `<div style="width:28px;height:18px;overflow:hidden;border-radius:4px"><img src="${img}" style="width:100%;height:100%;object-fit:cover"></div><div style="margin-left:6px">${h}</div>`;
    miniMy.appendChild(d);
  });
  picked.enemy.filter(Boolean).forEach(h=>{
    const short = heroShort[h] || ''; const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
    const d = document.createElement('div'); d.className='flex'; d.style.marginBottom='6px';
    d.innerHTML = `<div style="width:28px;height:18px;overflow:hidden;border-radius:4px"><img src="${img}" style="width:100%;height:100%;object-fit:cover"></div><div style="margin-left:6px">${h}</div>`;
    miniEnemy.appendChild(d);
  });
}

/* ============================
   Results screen
   ============================ */

async function showResults(){
  // require all picks? allow if not -> confirm
  if(picked.my.filter(Boolean).length !==5 || picked.enemy.filter(Boolean).length !==5){
    if(!confirm('–ù–µ –≤—Å—ñ —Å–ª–æ—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ. –ü–æ–∫–∞–∑–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –∑–∞—Ä–∞–∑?')) return;
  }
  roleScreen.style.display='none'; draftScreen.style.display='none'; resultsScreen.style.display='block';

  finalMy.innerHTML=''; finalEnemy.innerHTML='';
  picked.my.forEach((h,i)=>{
    const short = h ? heroShort[h] : ''; const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
    const div = document.createElement('div'); div.style.display='flex'; div.style.gap='8px'; div.style.alignItems='center'; div.style.marginBottom='6px';
    div.innerHTML = `<div style="width:44px;height:26px;border-radius:4px;overflow:hidden"><img src="${img}" style="width:100%;height:100%;object-fit:cover"></div><div style="flex:1">${h||'‚Äî'}</div><div class="tiny">slot ${i+1}</div>`;
    finalMy.appendChild(div);
  });
  picked.enemy.forEach((h,i)=>{
    const short = h ? heroShort[h] : ''; const img = short ? `https://api.opendota.com/apps/dota2/images/heroes/${short}_full.png` : '';
    const div = document.createElement('div'); div.style.display='flex'; div.style.gap='8px'; div.style.alignItems='center'; div.style.marginBottom='6px';
    div.innerHTML = `<div style="width:44px;height:26px;border-radius:4px;overflow:hidden"><img src="${img}" style="width:100%;height:100%;object-fit:cover"></div><div style="flex:1">${h||'‚Äî'}</div><div class="tiny">slot ${i+1}</div>`;
    finalEnemy.appendChild(div);
  });

  // compute final estimates & strategy
  await computeLiveEstimate();
  finalWin.textContent = winEstimateEl.textContent;
  finalStrategy.textContent = getStrategy(picked.my.filter(Boolean));
  finalAnalysis.textContent = analysisText.textContent + '\n\nüîé –ü–æ—Ä–∞–¥–∞: –æ–±–∏—Ä–∞–π –≥–µ—Ä–æ—è –∑ –≤–∏—Å–æ–∫–∏–º —Å–µ—Ä–µ–¥–Ω—ñ–º winrate –ø—Ä–æ—Ç–∏ –≤–æ—Ä–æ–∂–∏—Ö –ø—ñ–∫ —ñ —è–∫–∏–π –¥–æ–ø–æ–≤–Ω—é—î —Å–æ—é–∑–Ω–∏–∫—ñ–≤.';
}

/* ============================
   Strategy helper
   ============================ */

function getStrategy(myHeroes){
  const carry = ["Spectre","Terrorblade","Medusa","Anti-Mage","Faceless Void","Naga Siren"];
  const push = ["Lycan","Nature's Prophet","Shadow Shaman","Death Prophet","Broodmother"];
  const fight = ["Magnus","Phoenix","Disruptor","Tidehunter","Enigma","Kunkka"];
  const heal = ["Dazzle","Omniknight","Treant Protector","Warlock"];
  const burst = ["Lina","Lion","Pugna","Zeus","Tinker"];
  let score = {carry:0,push:0,fight:0,heal:0,burst:0};
  for(const h of myHeroes){
    if(carry.includes(h)) score.carry++;
    if(push.includes(h)) score.push++;
    if(fight.includes(h)) score.fight++;
    if(heal.includes(h)) score.heal++;
    if(burst.includes(h)) score.burst++;
  }
  const max = Object.keys(score).reduce((a,b)=>score[a]>score[b]?a:b);
  switch(max){
    case 'carry': return '–ü–µ—Ä–µ–≤–∞–≥–∞ –≤ –ª–µ–π—Ç—ñ ‚Äî —Ä–æ–∑–∫–∞—á–∞–π—Ç–µ—Å—è –¥–æ 30 —Ö–≤.';
    case 'push': return '–°–∏–ª—å–Ω–∏–π –ø—É—à ‚Äî –∑–∞—á–∏—Å—Ç—ñ—Ç—å –≤–µ–∂—ñ —ñ –∑–∞–≤–µ—Ä—à—ñ—Ç—å –≥—Ä—É —Ä–∞–Ω—ñ—à–µ.';
    case 'fight': return '–ü–æ—Ç—É–∂–Ω—ñ –∫–æ–º–∞–Ω–¥–Ω—ñ –±–æ—ó ‚Äî —à—É–∫–∞–π—Ç–µ —ñ–Ω—ñ—Ü—ñ–∞—Ü—ñ—é —ñ –∫–æ–Ω—Ç—Ä–æ–ª—å.';
    case 'heal': return '–í–∏—Å–æ–∫–∞ —Å—Ç—ñ–π–∫—ñ—Å—Ç—å ‚Äî –≥—Ä–∞–π—Ç–µ –Ω–∞ –≤–∏–∂–∏–≤–∞–Ω–Ω—è —ñ –æ–±–∏—Ä–∞–π—Ç–µ –¥–æ–≤–≥—É –≥—Ä—É.';
    case 'burst': return '–í–∏—Å–æ–∫–∏–π –≤–∏–±—É—Ö–æ–≤–∏–π —É—Ä–æ–Ω ‚Äî —Ñ–æ–∫—É—Å—É–π—Ç–µ –∫–ª—é—á–æ–≤—ñ —Ü—ñ–ª—ñ.';
    default: return '–ó–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ ‚Äî —Ä–µ–∞–≥—É–π—Ç–µ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ —Å—É–ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.';
  }
}

/* ============================
   Buttons
   ============================ */

startBtn.addEventListener('click', ()=>{
  if(!playerRole){ alert('–û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å'); return; }
  roleScreen.style.display='none'; draftScreen.style.display='block';
  renderAllSlots();
  pickerContext.textContent = '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Pick –≤ —Å–ª–æ—Ç—ñ, –∫—É–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –≥–µ—Ä–æ—è';
});

randomRoleBtn.addEventListener('click', ()=>{
  const r = roleKeys[Math.floor(Math.random()*roleKeys.length)];
  document.querySelectorAll('.role-btn').forEach(b=>b.classList.toggle('active', b.textContent===r));
  playerRole = r; startBtn.disabled=false; playerRoleLabel.textContent=r; updateSuggestions();
});

resetPicksBtn.addEventListener('click', ()=> {
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø—ñ–∫–∏?')) return;
  picked = { my: Array(5).fill(null), enemy: Array(5).fill(null) };
  activeSlot = null; matchupCache = {}; refreshAll();
});

finishDraftBtn.addEventListener('click', ()=> showResults());

restartBtn.addEventListener('click', ()=>{
  // reset everything
  picked = { my: Array(5).fill(null), enemy: Array(5).fill(null) };
  playerRole = null; activeSlot = null; matchupCache = {};
  roleScreen.style.display='block'; draftScreen.style.display='none'; resultsScreen.style.display='none';
  document.querySelectorAll('.role-btn').forEach(b=>b.classList.remove('active'));
  startBtn.disabled = true; playerRoleLabel.textContent = '‚Äî';
  pickerContext.textContent = '–û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å';
  renderRoleButtons(); populateHeroPicker(); renderAllSlots();
  winEstimateEl.textContent='‚Äî'; analysisText.textContent='';
});

/* ============================
   Init
   ============================ */

await loadHeroList();
renderAllSlots();
updateSuggestions();

})(); // IIFE
</script>
</body>
</html>








