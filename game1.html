<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dota 2 Draft Helper & Analytics</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fira+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0b1220;
    --card: #09111a;
    --accent: #f84c4c;
    --text: #e0e0e0;
    --muted: #888;
  }
  body {
    font-family: 'Fira Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
  }
  h3 { margin: 0.2em 0; }
  .container { display: flex; flex-wrap: wrap; gap: 1rem; padding: 1rem; }
  .column { background: var(--card); padding: 1rem; border-radius: 1rem; flex: 1; min-width: 220px; }
  ul { list-style: none; padding: 0; margin: 0; }
  li { margin: 0.2em 0; }
  button { background: var(--accent); color: #fff; border: none; padding: 0.5em 1em; cursor: pointer; border-radius: 0.5rem; margin-top: 0.5em; }
  #results { margin-top: 1rem; }
</style>
</head>
<body>

<div class="container">
  <div class="column">
    <h2>Моя команда</h2>
    <ul id="myTeamList"></ul>
  </div>
  <div class="column">
    <h2>Carry</h2>
    <ul id="carryList"></ul>
  </div>
  <div class="column">
    <h2>Support</h2>
    <ul id="supportList"></ul>
  </div>
  <div class="column">
    <h2>Противники</h2>
    <ul id="enemyTeamList"></ul>
  </div>
</div>

<button id="calculateBtn">Розрахувати шанси</button>
<div id="results"></div>

<script>
// ===================== Дані для тесту (замінити на API) =====================
const accountId = 863386335; // твій OpenDota accountId

// ===================== Основна функція =====================
async function renderAnalytics(accountId) {
  // ==== 1️⃣ Отримуємо дані з OpenDota API ====
  const matchesRes = await fetch(`https://api.opendota.com/api/players/${accountId}/recentMatches`);
  const matches = await matchesRes.json();

  const heroesRes = await fetch(`https://api.opendota.com/api/players/${accountId}/heroes`);
  const heroes = await heroesRes.json();

  const playerRes = await fetch(`https://api.opendota.com/api/players/${accountId}`);
  const playerData = await playerRes.json();
  const mmr = playerData.mmr_estimate?.estimate || 3000;

  // ==== 2️⃣ Метрики продуктивності ====
  const totalKills = matches.reduce((s, m) => s + m.kills, 0);
  const totalAssists = matches.reduce((s, m) => s + m.assists, 0);
  const totalDeaths = matches.reduce((s, m) => s + Math.max(1, m.deaths), 0);
  const totalTeamKills = matches.reduce((s, m) => s + (m.kills + m.assists)/2, 0);

  const killParticipation = (totalKills + totalAssists) / Math.max(1, totalTeamKills);
  const damagePerGold = matches.reduce((s, m) => s + (m.hero_damage / Math.max(1, m.net_worth)), 0) / matches.length;
  const supportEfficiency = matches.reduce((s, m) => s + ((m.wards_placed || 0) + (m.wards_killed || 0) + (m.heal || 0)), 0) / matches.length;

  const consistency = 1 / (1 + Math.sqrt(matches.reduce((s, m) => {
    const perf = (m.kills + m.assists) / Math.max(1, m.deaths);
    return s + Math.pow(perf - ((totalKills + totalAssists) / totalDeaths), 2);
  }, 0)/matches.length));

  // ==== 3️⃣ Рольова класифікація ====
  const roleWeights = { carry: 1.0, mid: 0.9, offlane: 0.8, support: 0.85, hardSupport: 0.7 };
  const dynamicRoleAdjust = 1 + ((supportEfficiency * 0.2) + (killParticipation * 0.3));

  // ==== 4️⃣ Система Glück/Glicko ====
  function sigmoid(x){ return 1/(1+Math.exp(-x)); }
  const impact = 1; // placeholder для старих метрик (залишаємо для сумісності)
  const volatility = 0.06 + (1 - consistency);
  const glickRating = mmr + (impact * 100) - (volatility * 50);
  const expectedWin = sigmoid((glickRating - 3000)/400);

  // ==== 5️⃣ Додаткові фактори ====
  const recentMatches = matches.slice(-10);
  const fatigue = Math.min(1, recentMatches.length/10); 
  const fatigueFactor = 1 - fatigue*0.1;

  const winHistory = matches.map(m => m.radiant_win === (m.player_slot < 128) ? 1 : 0);
  let markovTrend = 0;
  for(let i=1;i<winHistory.length;i++) markovTrend += winHistory[i]===winHistory[i-1]?0.05:-0.05;
  const trendFactor = 1 + markovTrend / winHistory.length;

  const synergy = heroes.reduce((s,h)=> s + h.win / Math.max(1, h.games), 0)/heroes.length;

  // ==== 6️⃣ Остаточна формула прогнозу шансу ====
  const base = (killParticipation*0.2 + damagePerGold*0.2 + supportEfficiency*0.1 + consistency*0.15 + expectedWin*0.35);
  const adjusted = base * dynamicRoleAdjust * trendFactor * fatigueFactor * (0.9 + synergy*0.1);
  const winProb = Math.min(0.98, Math.max(0.02, adjusted));

  // ==== 7️⃣ Висновок ====
  const confidence = 0.05 + (consistency*0.2);
  document.getElementById("results").innerHTML = `
    <h3>Ймовірність перемоги: ${(winProb*100).toFixed(2)}% ± ${(confidence*100).toFixed(1)}%</h3>
    <p><b>MMR:</b> ${mmr}</p>
    <p><b>KDA Consistency:</b> ${(consistency*100).toFixed(1)}%</p>
    <p><b>Kill Participation:</b> ${(killParticipation*100).toFixed(1)}%</p>
    <p><b>Damage/Gold:</b> ${damagePerGold.toFixed(3)}, <b>Support Efficiency:</b> ${supportEfficiency.toFixed(2)}</p>
    <p><b>Glück Rating:</b> ${glickRating.toFixed(0)}, <b>Synergy:</b> ${(synergy*100).toFixed(1)}%</p>
  `;

  // ==== 8️⃣ Відображення команд (залишаємо без змін) ====
  const myTeam = matches.slice(0,5).map(m=>`<li>${m.hero_id}</li>`).join("");
  const carryList = matches.filter(m=>m.lane_role===1).map(m=>`<li>${m.hero_id}</li>`).join("");
  const supportList = matches.filter(m=>m.lane_role>=3).map(m=>`<li>${m.hero_id}</li>`).join("");
  const enemyTeam = matches.slice(5,10).map(m=>`<li>${m.hero_id}</li>`).join("");

  document.getElementById('myTeamList').innerHTML = myTeam;
  document.getElementById('carryList').innerHTML = carryList;
  document.getElementById('supportList').innerHTML = supportList;
  document.getElementById('enemyTeamList').innerHTML = enemyTeam;
}

// ==== Кнопка розрахунку ====
document.getElementById("calculateBtn").addEventListener("click", () => {
  renderAnalytics(accountId);
});
</script>

</body>
</html>

















