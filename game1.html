<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Dota 2 Match Predictor (OpenDota)</title>
  <style>
    body { background:#111; color:#eee; font-family:monospace; padding:20px; }
    h1 { color:#6cf; }
    .match { margin:5px 0; padding:5px; border-bottom:1px solid #333; }
    .good { color:#6f6; }
    .bad { color:#f66; }
  </style>
</head>
<body>
  <h1>Dota 2 Match Predictor</h1>
  <div id="summary"></div>
  <div id="matches"></div>

  <script>
    const accountId32 = 863386335; // —Ç–≤—ñ–π Steam32 ID
    const MATCH_COUNT = 100;

    async function fetchMatchHistory() {
      const url = `http://localhost:3000/api/matches?account_id=${accountId32}&count=${MATCH_COUNT}`;
      const res = await fetch(url);
      return await res.json(); // OpenDota –æ–¥—Ä–∞–∑—É –ø–æ–≤–µ—Ä—Ç–∞—î –º–∞—Å–∏–≤ –º–∞—Ç—á—ñ–≤
    }

    async function fetchMatchDetails(matchId) {
      const url = `http://localhost:3000/api/match/${matchId}`;
      const res = await fetch(url);
      return await res.json();
    }

    function analyzePlayer(match, accountId32) {
      // OpenDota –≤–∂–µ –¥–∞—î –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø–æ–ª—è
      const k = match.kills;
      const d = match.deaths;
      const a = match.assists;
      const kda = ((k + a) / Math.max(1, d)).toFixed(2);
      const win = match.radiant_win === (match.player_slot < 128);
      return { k, d, a, kda: parseFloat(kda), win };
    }

    async function analyzeMatches() {
      const matches = await fetchMatchHistory();
      const container = document.getElementById("matches");

      let total = 0, wins = 0, sumKDA = 0;
      let boosters = 0, ruiners = 0;

      for (const m of matches) {
        const stats = analyzePlayer(m, accountId32);
        total++;
        if (stats.win) wins++;
        sumKDA += stats.kda;

        if (stats.kda >= 6 && stats.win) boosters++;
        if (stats.kda <= 1 && !stats.win) ruiners++;

        const div = document.createElement("div");
        div.className = "match";
        div.innerHTML = `Match ${m.match_id}: 
          <span class="${stats.win ? 'good':'bad'}">${stats.win ? 'WIN':'LOSS'}</span> 
          | Hero=${m.hero_id} | K=${stats.k}, D=${stats.d}, A=${stats.a}, KDA=${stats.kda}`;
        container.appendChild(div);
      }

      const winrate = ((wins / total) * 100).toFixed(1);
      const avgKDA = (sumKDA / total).toFixed(2);
      const boosterChance = ((boosters / total) * 100).toFixed(1);
      const ruinerChance = ((ruiners / total) * 100).toFixed(1);
      const nextWinChance = winrate;

      document.getElementById("summary").innerHTML = `
        <h2>üìä Summary (${total} –º–∞—Ç—á—ñ–≤)</h2>
        Winrate: ${winrate}%<br>
        –°–µ—Ä–µ–¥–Ω—ñ–π KDA: ${avgKDA}<br><br>
        üîÆ –ü—Ä–æ–≥–Ω–æ–∑:<br>
        –®–∞–Ω—Å –ø–µ—Ä–µ–º–æ–≥–∏ —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –º–∞—Ç—á—ñ: ${nextWinChance}%<br>
        –®–∞–Ω—Å –∑—É—Å—Ç—Ä—ñ—Ç–∏ –±—É—Å—Ç–µ—Ä–∞: ${boosterChance}%<br>
        –®–∞–Ω—Å –∑—É—Å—Ç—Ä—ñ—Ç–∏ —Ä—É—ñ–Ω–µ—Ä–∞: ${ruinerChance}%
      `;
    }

    analyzeMatches();
  </script>
</body>
</html>
    analyzeMatches();
  </script>
</body>
</html>
