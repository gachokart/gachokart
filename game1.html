<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Dota 2 Match Predictor (Steam API)</title>
  <style>
    body { background:#111; color:#eee; font-family:monospace; padding:20px; }
    h1 { color:#6cf; }
    .match { margin:5px 0; padding:5px; border-bottom:1px solid #333; }
    .good { color:#6f6; }
    .bad { color:#f66; }
  </style>
</head>
<body>
  <h1>Dota 2 Match Predictor</h1>
  <div id="summary"></div>
  <div id="matches"></div>

  <script>
    const accountId32 = 863386335; // —Ç–≤—ñ–π Steam32 ID
    const API_KEY = "F376439B1833C7DF76D6AB25A571755E"; // –≤—Å—Ç–∞–≤ —Å–≤—ñ–π –∫–ª—é—á —Å—é–¥–∏
    const MATCH_COUNT = 100;

    async function fetchMatchHistory() {
      const url = `https://api.steampowered.com/IDOTA2Match_570/GetMatchHistory/v1/?key=${API_KEY}&account_id=${accountId32}&matches_requested=${MATCH_COUNT}`;
      const res = await fetch(url);
      const data = await res.json();
      return data.result.matches || [];
    }

    async function fetchMatchDetails(matchId) {
      const url = `https://api.steampowered.com/IDOTA2Match_570/GetMatchDetails/v1/?key=${API_KEY}&match_id=${matchId}`;
      const res = await fetch(url);
      return await res.json();
    }

    function analyzePlayer(match, accountId32) {
      const player = match.players.find(p => p.account_id === accountId32);
      if (!player) return null;
      const k = player.kills;
      const d = player.deaths;
      const a = player.assists;
      const kda = ((k + a) / Math.max(1, d)).toFixed(2);
      const win = (player.player_slot < 128) === match.radiant_win;
      return { k, d, a, kda: parseFloat(kda), win };
    }

    async function analyzeMatches() {
      const matches = await fetchMatchHistory();
      if (!matches.length) {
        document.getElementById("summary").innerHTML = "‚ùå –ú–∞—Ç—á—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä –∫–ª—é—á —ñ Steam32 ID.";
        return;
      }

      const container = document.getElementById("matches");
      let total = 0, wins = 0, sumKDA = 0, boosters = 0, ruiners = 0;

      for (const m of matches) {
        const details = await fetchMatchDetails(m.match_id);
        const stats = analyzePlayer(details.result, accountId32);
        if (!stats) continue;

        total++;
        if (stats.win) wins++;
        sumKDA += stats.kda;
        if (stats.kda >= 6 && stats.win) boosters++;
        if (stats.kda <= 1 && !stats.win) ruiners++;

        const div = document.createElement("div");
        div.className = "match";
        div.innerHTML = `Match ${m.match_id}: 
          <span class="${stats.win ? 'good':'bad'}">${stats.win ? 'WIN':'LOSS'}</span> 
          | K=${stats.k}, D=${stats.d}, A=${stats.a}, KDA=${stats.kda}`;
        container.appendChild(div);
      }

      const winrate = ((wins / total) * 100).toFixed(1);
      const avgKDA = (sumKDA / total).toFixed(2);
      const boosterChance = ((boosters / total) * 100).toFixed(1);
      const ruinerChance = ((ruiners / total) * 100).toFixed(1);

      document.getElementById("summary").innerHTML = `
        <h2>üìä Summary (${total} –º–∞—Ç—á—ñ–≤)</h2>
        Winrate: ${winrate}%<br>
        –°–µ—Ä–µ–¥–Ω—ñ–π KDA: ${avgKDA}<br><br>
        üîÆ –ü—Ä–æ–≥–Ω–æ–∑:<br>
        –®–∞–Ω—Å –ø–µ—Ä–µ–º–æ–≥–∏ —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –º–∞—Ç—á—ñ: ${winrate}%<br>
        –®–∞–Ω—Å –∑—É—Å—Ç—Ä—ñ—Ç–∏ –±—É—Å—Ç–µ—Ä–∞: ${boosterChance}%<br>
        –®–∞–Ω—Å –∑—É—Å—Ç—Ä—ñ—Ç–∏ —Ä—É—ñ–Ω–µ—Ä–∞: ${ruinerChance}%
      `;
    }

    analyzeMatches();
  </script>
</body>
</html>
    analyzeMatches();
  </script>
</body>
</html>
